<% include header %>

<script>

if (!window.opener) {
    document.write('No window opener.');
}

var args = window.location.search.slice(1).split('&');
var code = null;
var redirectURI = null;

args.forEach(function (arg) {
    'use strict';

    var tmp = arg.split('=');
    if (tmp[0] === 'redirectURI') {
        redirectURI = window.decodeURIComponent(tmp[1]);
    } else if (tmp[0] === 'code') {
        code = window.decodeURIComponent(tmp[1]);
    }
});

if (code && redirectURI) {
    window.opener.postMessage(JSON.stringify({ authCode: code}), redirectURI);
    window.close();
} else {
    document.write('Missing query arguments.');
}

</script>

<% include footer %>