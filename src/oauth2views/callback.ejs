<% include header %>

<script>

'use strict';

var code = null;
var redirectURI = null;

var args = window.location.search.slice(1).split('&');
args.forEach(function (arg) {
    var tmp = arg.split('=');
    if (tmp[0] === 'redirectURI') {
        redirectURI = window.decodeURIComponent(tmp[1]);
    } else if (tmp[0] === 'code') {
        code = window.decodeURIComponent(tmp[1]);
    }
});

if (code && redirectURI) {
    // TODO for now we only support redirection
    window.location.href = redirectURI + '?authCode=' + code;

    // if (!window.opener) {
    //     window.location.href = redirectURI + '?authCode=' + code;
    // } else {
    //     window.opener.postMessage(JSON.stringify({ authCode: code}), redirectURI);
    //     window.close();
    // }
} else {
    window.location.href = '/api/v1/session/login';
}

</script>

<% include footer %>;