<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height" />

    <title> App Status </title>

  </head>

<body>

    <div id="appstatus"> Getting application status ... </div>

    <script>
        var subdomain = window.location.host.substr(0, window.location.host.indexOf('.'));
        var BOX =  window.location.host.substr(subdomain.length + 1);

        function refresh() {
            var ajax = new XMLHttpRequest();

            var statusDiv = document.getElementById('appstatus');

            ajax.onreadystatechange = function() {
                if (ajax.readyState == 4) {
                    if (ajax.status == 200) {
                        var response = JSON.parse(ajax.responseText);
                        statusDiv.innerHTML = response.statusCode;
                        if (response.statusCode === 'running') {
                            window.location.reload();
                        }
                    } else {
                        statusDiv.innerHTML = 'Error getting status';
                    }
                    setTimeout(refresh, 1000);
                }
            };

            ajax.open('GET', 'https://' + BOX + '/api/v1/subdomain/' + subdomain, true);
            ajax.send();
        }

        refresh();
    </script>
</body>

</html>
