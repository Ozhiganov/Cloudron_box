"use strict";var app=angular.module("Application",["ngAnimate","angular-md5"]);app.controller("SetupController",["$scope","Client",function(t,e){t.initialized=!1,t.busy=!1,t.username="",t.email="",t.password="",t.passwordRepeat="";var n=window.location.search.slice(1).split("&").map(function(t){return t.split("=")}).reduce(function(t,e){return t[e[0]]=e[1],t},{});t.setupToken=n.setupToken,t.error="",t.submit=function(){t.busy=!0,t.error="",e.createAdmin(t.username,t.password,t.email,t.setupToken,function(e){return e?(t.error=e.message,console.error("Internal error",e),void(t.busy=!1)):void(window.location.href="/")})},e.isServerFirstTime(function(e,n){return e?void(window.location.href="/error.html"):n?(t.initialized=!0,void setTimeout(function(){$("input[autofocus]:visible:first").focus()},0)):void(window.location.href="/")})}]),angular.module("Application").service("Client",["$http","md5",function(t,e){function n(t,e){Error.call(this),this.name=this.constructor.name,this.statusCode=t,this.message="string"==typeof e?e:JSON.stringify(e)}function o(t){return function(e,o){return 401===o?i.logout():void t(new n(o,e))}}function r(){this._ready=!1,this._configListener=[],this._readyListener=[],this._userInfo={username:null,email:null,admin:!1},this._token=null,this._clientId="cid-webadmin",this._clientSecret="unused",this._config={apiServerOrigin:null,webServerOrigin:null,fqdn:null,ip:null,revision:null,update:null,isDev:!1,progress:{}},this._installedApps=[],this.setToken(localStorage.token)}var i=null;return r.prototype.setReady=function(){this._ready||(this._ready=!0,this._readyListener.forEach(function(t){t()}))},r.prototype.onReady=function(t){this._ready&&t(),this._readyListener.push(t)},r.prototype.onConfig=function(t){this._configListener.push(t),t(this._config)},r.prototype.setUserInfo=function(t){this._userInfo.username=t.username,this._userInfo.email=t.email,this._userInfo.admin=!!t.admin,this._userInfo.gravatar="https://www.gravatar.com/avatar/"+e.createHash(t.email.toLowerCase())+".jpg?s=24&d=mm"},r.prototype.setConfig=function(t){this._config.apiServerOrigin=t.apiServerOrigin,this._config.webServerOrigin=t.webServerOrigin,this._config.version=t.version,this._config.fqdn=t.fqdn,this._config.ip=t.ip,this._config.revision=t.revision,this._config.update=t.update,this._config.isDev=t.isDev,this._config.progress=t.progress;var e=this;this._configListener.forEach(function(t){t(e._config)})},r.prototype.getInstalledApps=function(){return this._installedApps},r.prototype.getUserInfo=function(){return this._userInfo},r.prototype.getConfig=function(){return this._config},r.prototype.setToken=function(e){t.defaults.headers.common.Authorization="Bearer "+e,e?localStorage.token=e:localStorage.removeItem("token"),this._token=e},r.prototype.config=function(e){t.get("/api/v1/cloudron/config").success(function(t,o){return 200!==o||"object"!=typeof t?e(new n(o,t)):void e(null,t)}).error(o(e))},r.prototype.userInfo=function(e){t.get("/api/v1/profile").success(function(t,o){return 200!==o||"object"!=typeof t?e(new n(o,t)):void e(null,t)}).error(o(e))},r.prototype.installApp=function(e,r,i,s,p,u){var c=this,a={appStoreId:e,version:r,password:i,location:p.location,portBindings:p.portBindings,accessRestriction:p.accessRestriction};t.post("/api/v1/apps/install",a).success(function(t,e){return 202!==e||"object"!=typeof t?u(new n(e,t)):(t.manifest={title:s},c._installedApps.push(t),void u(null,t.id))}).error(o(u))},r.prototype.uninstallApp=function(e,r,i){var s={password:r};t.post("/api/v1/apps/"+e+"/uninstall",s).success(function(t,e){return 202!==e?i(new n(e,t)):void i(null)}).error(o(i))},r.prototype.configureApp=function(e,r,i,s){var p={appId:e,password:r,location:i.location,portBindings:i.portBindings,accessRestriction:i.accessRestriction};t.post("/api/v1/apps/"+e+"/configure",p).success(function(t,e){return 202!==e?s(new n(e,t)):void s(null)}).error(o(s))},r.prototype.updateApp=function(e,r,i,s){t.post("/api/v1/apps/"+e+"/update",{version:r,password:i}).success(function(t,e){return 202!==e?s(new n(e,t)):void s(null)}).error(o(s))},r.prototype.startApp=function(e,r){var i={};t.post("/api/v1/apps/"+e+"/start",i).success(function(t,e){return 202!==e?r(new n(e,t)):void r(null)}).error(o(r))},r.prototype.stopApp=function(e,r){var i={};t.post("/api/v1/apps/"+e+"/stop",i).success(function(t,e){return 202!==e?r(new n(e,t)):void r(null)}).error(o(r))},r.prototype.version=function(e){t.get("/api/v1/cloudron/status").success(function(t,o){return 200!==o||"object"!=typeof t?e(new n(o,t)):void e(null,t)}).error(o(e))},r.prototype.isServerFirstTime=function(e){t.get("/api/v1/cloudron/status").success(function(t,o){return 200!==o||"object"!=typeof t?e(new n(o,t)):void e(null,!t.activated)}).error(o(e))},r.prototype.getNakedDomain=function(e){t.get("/api/v1/settings/naked_domain").success(function(t,o){return 200!==o||"object"!=typeof t?e(new n(o,t)):void e(null,t.appid)}).error(o(e))},r.prototype.setNakedDomain=function(e,r){t.post("/api/v1/settings/naked_domain",{appid:e}).success(function(t,e){return 204!==e?r(new n(e)):void r(null)}).error(o(r))},r.prototype.getApps=function(e){t.get("/api/v1/apps").success(function(t,o){return 200!==o||"object"!=typeof t?e(new n(o,t)):void e(null,t.apps)}).error(o(e))},r.prototype.getApp=function(t,e){var n=null;return this._installedApps.some(function(e){return e.id===t?(n=e,!0):!1}),n?e(null,n):e(new Error("App not found"))},r.prototype.getAppLogStream=function(t){var e=new EventSource("/api/v1/apps/"+t+"/logstream");return e},r.prototype.getAppLogUrl=function(t){return"/api/v1/apps/"+t+"/logs?access_token="+this._token},r.prototype.setAdmin=function(e,r,i){var s={username:e,admin:r};t.post("/api/v1/users/"+e+"/admin",s).success(function(t,e){return 204!==e?i(new n(e,t)):void i(null)}).error(o(i))},r.prototype.createAdmin=function(e,r,i,s,p){var u={username:e,password:r,email:i},c=this;t.post("/api/v1/cloudron/activate?setupToken="+s,u).success(function(t,o){return 201!==o||"object"!=typeof t?p(new n(o,t)):(c.setToken(t.token),c.setUserInfo({username:e,email:i,admin:!0}),void p(null,t.activated))}).error(o(p))},r.prototype.listUsers=function(e){t.get("/api/v1/users").success(function(t,o){return 200!==o||"object"!=typeof t?e(new n(o,t)):void e(null,t)}).error(o(e))},r.prototype.stats=function(e){t.get("/api/v1/cloudron/stats").success(function(t,o){return 200!==o||"object"!=typeof t?e(new n(o,t)):void e(null,t)}).error(o(e))},r.prototype.getOAuthClients=function(e){t.get("/api/v1/oauth/clients").success(function(t,o){return 200!==o||"object"!=typeof t?e(new n(o,t)):void e(null,t.clients)}).error(o(e))},r.prototype.delTokensByClientId=function(e,r){t["delete"]("/api/v1/oauth/clients/"+e+"/tokens").success(function(t,e){return 204!==e?r(new n(e,t)):void r(null)}).error(o(r))},r.prototype.update=function(e){t.get("/api/v1/cloudron/update").success(function(t,o){return 202!==o||"object"!=typeof t?e(new n(o,t)):void e(null,t)}).error(o(e))},r.prototype.reboot=function(e){t.get("/api/v1/cloudron/reboot").success(function(t,o){return 202!==o||"object"!=typeof t?e(new n(o,t)):void e(null,t)}).error(o(e))},r.prototype.backup=function(e){t.post("/api/v1/cloudron/backups").success(function(t,o){return 202!==o||"object"!=typeof t?e(new n(o,t)):void e(null,t)}).error(o(e))},r.prototype.setCertificate=function(e,r,i){console.log("will set certificate");var s=new FormData;s.append("certificate",e),s.append("key",r),t.post("/api/v1/cloudron/certificate",s,{headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(function(t,e){return 202!==e?i(new n(e,t)):void i(null)}).error(o(i))},r.prototype.graphs=function(e,r,i){var s={params:{target:e,format:"json",from:r}};t.get("/api/v1/cloudron/graphs",s).success(function(t,e){return 200!==e||"object"!=typeof t?i(new n(e,t)):void i(null,t)}).error(o(i))},r.prototype.createUser=function(e,r,i){var s={username:e,email:r};t.post("/api/v1/users",s).success(function(t,e){return 201!==e||"object"!=typeof t?i(new n(e,t)):void i(null,t)}).error(o(i))},r.prototype.removeUser=function(e,r,i){var s={username:e,password:r};t({method:"DELETE",url:"/api/v1/users/"+e,data:s,headers:{"Content-Type":"application/json"}}).success(function(t,e){return 204!==e?i(new n(e,t)):void i(null)}).error(o(i))},r.prototype.changePassword=function(e,r,i){var s={password:e,newPassword:r};t.post("/api/v1/users/"+this._userInfo.username+"/password",s).success(function(t,e){return 204!==e||"object"!=typeof t?i(new n(e,t)):void i(null,t)}).error(o(i))},r.prototype.refreshConfig=function(t){var e=this;t="function"==typeof t?t:function(){},this.config(function(n,o){return n?t(n):(e.setConfig(o),void t(null))})},r.prototype.refreshInstalledApps=function(t){var e=this;t="function"==typeof t?t:function(){},this.getApps(function(n,o){if(n)return t(n);o.forEach(function(t){for(var n=!1,o=0;o<e._installedApps.length;++o)if(e._installedApps[o].id===t.id){n=o;break}n!==!1?angular.copy(t,e._installedApps[n]):e._installedApps.push(t)});for(var r=e._installedApps.length-1;r>=0;--r)o.some(function(t){return t.id===e._installedApps[r].id})||e._installedApps.splice(r,1);t(null)})},r.prototype.logout=function(){this.setToken(null),this._userInfo={},window.location.href="/api/v1/session/logout"},r.prototype.exchangeCodeForToken=function(e,r){var i={grant_type:"authorization_code",code:e,redirect_uri:window.location.origin,client_id:this._clientId,client_secret:this._clientSecret};t.post("/api/v1/oauth/token?response_type=token&client_id="+this._clientId,i).success(function(t,e){return 200!==e||"object"!=typeof t?r(new n(e,t)):void r(null,t.access_token)}).error(o(r))},i=new r}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNldHVwLmpzIiwiY2xpZW50LmpzIl0sIm5hbWVzIjpbImFwcCIsImFuZ3VsYXIiLCJtb2R1bGUiLCJjb250cm9sbGVyIiwiJHNjb3BlIiwiQ2xpZW50IiwiaW5pdGlhbGl6ZWQiLCJidXN5IiwidXNlcm5hbWUiLCJlbWFpbCIsInBhc3N3b3JkIiwicGFzc3dvcmRSZXBlYXQiLCJzZWFyY2giLCJ3aW5kb3ciLCJsb2NhdGlvbiIsInNsaWNlIiwic3BsaXQiLCJtYXAiLCJpdGVtIiwicmVkdWNlIiwibyIsImsiLCJzZXR1cFRva2VuIiwiZXJyb3IiLCJzdWJtaXQiLCJjcmVhdGVBZG1pbiIsIm1lc3NhZ2UiLCJjb25zb2xlIiwiaHJlZiIsImlzU2VydmVyRmlyc3RUaW1lIiwiaXNGaXJzdFRpbWUiLCJzZXRUaW1lb3V0IiwiJCIsImZvY3VzIiwic2VydmljZSIsIiRodHRwIiwibWQ1IiwiQ2xpZW50RXJyb3IiLCJzdGF0dXNDb2RlIiwiRXJyb3IiLCJjYWxsIiwidGhpcyIsIm5hbWUiLCJjb25zdHJ1Y3RvciIsIkpTT04iLCJzdHJpbmdpZnkiLCJkZWZhdWx0RXJyb3JIYW5kbGVyIiwiY2FsbGJhY2siLCJkYXRhIiwic3RhdHVzIiwiY2xpZW50IiwibG9nb3V0IiwiX3JlYWR5IiwiX2NvbmZpZ0xpc3RlbmVyIiwiX3JlYWR5TGlzdGVuZXIiLCJfdXNlckluZm8iLCJhZG1pbiIsIl90b2tlbiIsIl9jbGllbnRJZCIsIl9jbGllbnRTZWNyZXQiLCJfY29uZmlnIiwiYXBpU2VydmVyT3JpZ2luIiwid2ViU2VydmVyT3JpZ2luIiwiZnFkbiIsImlwIiwicmV2aXNpb24iLCJ1cGRhdGUiLCJpc0RldiIsInByb2dyZXNzIiwiX2luc3RhbGxlZEFwcHMiLCJzZXRUb2tlbiIsImxvY2FsU3RvcmFnZSIsInRva2VuIiwicHJvdG90eXBlIiwic2V0UmVhZHkiLCJmb3JFYWNoIiwib25SZWFkeSIsInB1c2giLCJvbkNvbmZpZyIsInNldFVzZXJJbmZvIiwidXNlckluZm8iLCJncmF2YXRhciIsImNyZWF0ZUhhc2giLCJ0b0xvd2VyQ2FzZSIsInNldENvbmZpZyIsImNvbmZpZyIsInZlcnNpb24iLCJ0aGF0IiwiZ2V0SW5zdGFsbGVkQXBwcyIsImdldFVzZXJJbmZvIiwiZ2V0Q29uZmlnIiwiZGVmYXVsdHMiLCJoZWFkZXJzIiwiY29tbW9uIiwiQXV0aG9yaXphdGlvbiIsInJlbW92ZUl0ZW0iLCJnZXQiLCJzdWNjZXNzIiwiaW5zdGFsbEFwcCIsImlkIiwidGl0bGUiLCJhcHBTdG9yZUlkIiwicG9ydEJpbmRpbmdzIiwiYWNjZXNzUmVzdHJpY3Rpb24iLCJwb3N0IiwibWFuaWZlc3QiLCJ1bmluc3RhbGxBcHAiLCJhcHBJZCIsImNvbmZpZ3VyZUFwcCIsInVwZGF0ZUFwcCIsInN0YXJ0QXBwIiwic3RvcEFwcCIsImFjdGl2YXRlZCIsImdldE5ha2VkRG9tYWluIiwiYXBwaWQiLCJzZXROYWtlZERvbWFpbiIsImdldEFwcHMiLCJhcHBzIiwiZ2V0QXBwIiwiYXBwRm91bmQiLCJzb21lIiwiZ2V0QXBwTG9nU3RyZWFtIiwic291cmNlIiwiRXZlbnRTb3VyY2UiLCJnZXRBcHBMb2dVcmwiLCJzZXRBZG1pbiIsInBheWxvYWQiLCJsaXN0VXNlcnMiLCJzdGF0cyIsImdldE9BdXRoQ2xpZW50cyIsImNsaWVudHMiLCJkZWxUb2tlbnNCeUNsaWVudElkIiwicmVib290IiwiYmFja3VwIiwic2V0Q2VydGlmaWNhdGUiLCJjZXJ0aWZpY2F0ZUZpbGUiLCJrZXlGaWxlIiwibG9nIiwiZmQiLCJGb3JtRGF0YSIsImFwcGVuZCIsIkNvbnRlbnQtVHlwZSIsInVuZGVmaW5lZCIsInRyYW5zZm9ybVJlcXVlc3QiLCJpZGVudGl0eSIsImdyYXBocyIsInRhcmdldHMiLCJmcm9tIiwicGFyYW1zIiwidGFyZ2V0IiwiZm9ybWF0IiwiY3JlYXRlVXNlciIsInJlbW92ZVVzZXIiLCJtZXRob2QiLCJ1cmwiLCJjaGFuZ2VQYXNzd29yZCIsImN1cnJlbnRQYXNzd29yZCIsIm5ld1Bhc3N3b3JkIiwicmVmcmVzaENvbmZpZyIsInJlc3VsdCIsInJlZnJlc2hJbnN0YWxsZWRBcHBzIiwiZm91bmQiLCJpIiwibGVuZ3RoIiwiY29weSIsImVsZW0iLCJzcGxpY2UiLCJleGNoYW5nZUNvZGVGb3JUb2tlbiIsImF1dGhDb2RlIiwiZ3JhbnRfdHlwZSIsImNvZGUiLCJyZWRpcmVjdF91cmkiLCJvcmlnaW4iLCJjbGllbnRfaWQiLCJjbGllbnRfc2VjcmV0IiwiYWNjZXNzX3Rva2VuIl0sIm1hcHBpbmdzIjoiQUFBQSxZQUdBLElBQUFBLEtBQUFDLFFBQUFDLE9BQUEsZUFBQSxZQUFBLGVBRUFGLEtBQUFHLFdBQUEsbUJBQUEsU0FBQSxTQUFBLFNBQUFDLEVBQUFDLEdBQ0FELEVBQUFFLGFBQUEsRUFDQUYsRUFBQUcsTUFBQSxFQUVBSCxFQUFBSSxTQUFBLEdBQ0FKLEVBQUFLLE1BQUEsR0FDQUwsRUFBQU0sU0FBQSxHQUNBTixFQUFBTyxlQUFBLEVBR0EsSUFBQUMsR0FBQUMsT0FBQUMsU0FBQUYsT0FBQUcsTUFBQSxHQUFBQyxNQUFBLEtBQUFDLElBQUEsU0FBQUMsR0FBQSxNQUFBQSxHQUFBRixNQUFBLE9BQUFHLE9BQUEsU0FBQUMsRUFBQUMsR0FBQSxNQUFBRCxHQUFBQyxFQUFBLElBQUFBLEVBQUEsR0FBQUQsTUFFQWhCLEdBQUFrQixXQUFBVixFQUFBVSxXQUVBbEIsRUFBQW1CLE1BQUEsR0FFQW5CLEVBQUFvQixPQUFBLFdBQ0FwQixFQUFBRyxNQUFBLEVBQ0FILEVBQUFtQixNQUFBLEdBRUFsQixFQUFBb0IsWUFBQXJCLEVBQUFJLFNBQUFKLEVBQUFNLFNBQUFOLEVBQUFLLE1BQUFMLEVBQUFrQixXQUFBLFNBQUFDLEdBQ0EsTUFBQUEsSUFDQW5CLEVBQUFtQixNQUFBQSxFQUFBRyxRQUNBQyxRQUFBSixNQUFBLGlCQUFBQSxRQUVBbkIsRUFBQUcsTUFBQSxTQUlBTSxPQUFBQyxTQUFBYyxLQUFBLFFBSUF2QixFQUFBd0Isa0JBQUEsU0FBQU4sRUFBQU8sR0FDQSxNQUFBUCxRQUNBVixPQUFBQyxT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QUQsUUFFQUQsR0FBQSxLQUFBQyxFQUFBK0gsZ0JBQ0F4SixNQUFBdUIsRUFBQUMsS0FHQUcsRUFBQSxHQUFBN0MiLCJmaWxlIjoic2V0dXAuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbi8vIGNyZWF0ZSBtYWluIGFwcGxpY2F0aW9uIG1vZHVsZVxudmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdBcHBsaWNhdGlvbicsIFsnbmdBbmltYXRlJywgJ2FuZ3VsYXItbWQ1J10pO1xuXG5hcHAuY29udHJvbGxlcignU2V0dXBDb250cm9sbGVyJywgWyckc2NvcGUnLCAnQ2xpZW50JywgZnVuY3Rpb24gKCRzY29wZSwgQ2xpZW50KSB7XG4gICAgJHNjb3BlLmluaXRpYWxpemVkID0gZmFsc2U7XG4gICAgJHNjb3BlLmJ1c3kgPSBmYWxzZTtcblxuICAgICRzY29wZS51c2VybmFtZSA9ICcnO1xuICAgICRzY29wZS5lbWFpbCA9ICcnO1xuICAgICRzY29wZS5wYXNzd29yZCA9ICcnO1xuICAgICRzY29wZS5wYXNzd29yZFJlcGVhdCA9ICcnO1xuXG4gICAgLy8gU3R1cGlkIGFuZ3VsYXIgbG9jYXRpb24gcHJvdmlkZXIgZWl0aGVyIHdhbnRzIGh0bWw1IGxvY2F0aW9uIG1vZGUgb3Igbm90LCBkbyB0aGUgcXVlcnkgcGFyc2luZyBvbiBteSBvd25cbiAgICB2YXIgc2VhcmNoID0gd2luZG93LmxvY2F0aW9uLnNlYXJjaC5zbGljZSgxKS5zcGxpdCgnJicpLm1hcChmdW5jdGlvbiAoaXRlbSkgeyByZXR1cm4gaXRlbS5zcGxpdCgnPScpOyB9KS5yZWR1Y2UoZnVuY3Rpb24gKG8sIGspIHsgb1trWzBdXSA9IGtbMV07IHJldHVybiBvOyB9LCB7fSk7XG5cbiAgICAkc2NvcGUuc2V0dXBUb2tlbiA9IHNlYXJjaC5zZXR1cFRva2VuO1xuXG4gICAgJHNjb3BlLmVycm9yID0gJyc7XG5cbiAgICAkc2NvcGUuc3VibWl0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAkc2NvcGUuYnVzeSA9IHRydWU7XG4gICAgICAgICRzY29wZS5lcnJvciA9ICcnO1xuXG4gICAgICAgIENsaWVudC5jcmVhdGVBZG1pbigkc2NvcGUudXNlcm5hbWUsICRzY29wZS5wYXNzd29yZCwgJHNjb3BlLmVtYWlsLCAkc2NvcGUuc2V0dXBUb2tlbiwgZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3IgPSBlcnJvci5tZXNzYWdlO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ludGVybmFsIGVycm9yJywgZXJyb3IpO1xuXG4gICAgICAgICAgICAgICAgJHNjb3BlLmJ1c3kgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJy8nO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgQ2xpZW50LmlzU2VydmVyRmlyc3RUaW1lKGZ1bmN0aW9uIChlcnJvciwgaXNGaXJzdFRpbWUpIHtcbiAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9ICcvZXJyb3IuaHRtbCc7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIWlzRmlyc3RUaW1lKSB7XG4gICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9ICcvJztcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgICRzY29wZS5pbml0aWFsaXplZCA9IHRydWU7XG5cbiAgICAgICAgLy8gaGFjayBmb3IgYXV0b2ZvY3VzIHdpdGggYW5ndWxhclxuICAgICAgICBzZXRUaW1lb3V0KCBmdW5jdGlvbiAoKSB7ICQoJ2lucHV0W2F1dG9mb2N1c106dmlzaWJsZTpmaXJzdCcpLmZvY3VzKCk7IH0sIDApO1xuICAgIH0pO1xufV0pO1xuIiwiJ3VzZSBzdHJpY3QnO1xuXG4vKiBnbG9iYWwgYW5ndWxhciAqL1xuLyogZ2xvYmFsIEV2ZW50U291cmNlICovXG5cbmFuZ3VsYXIubW9kdWxlKCdBcHBsaWNhdGlvbicpLnNlcnZpY2UoJ0NsaWVudCcsIFsnJGh0dHAnLCAnbWQ1JywgZnVuY3Rpb24gKCRodHRwLCBtZDUpIHtcbiAgICB2YXIgY2xpZW50ID0gbnVsbDtcblxuICAgIGZ1bmN0aW9uIENsaWVudEVycm9yKHN0YXR1c0NvZGUsIG1lc3NhZ2UpIHtcbiAgICAgICAgRXJyb3IuY2FsbCh0aGlzKTtcbiAgICAgICAgdGhpcy5uYW1lID0gdGhpcy5jb25zdHJ1Y3Rvci5uYW1lO1xuICAgICAgICB0aGlzLnN0YXR1c0NvZGUgPSBzdGF0dXNDb2RlO1xuICAgICAgICBpZiAodHlwZW9mIG1lc3NhZ2UgPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIHRoaXMubWVzc2FnZSA9IG1lc3NhZ2U7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLm1lc3NhZ2UgPSBKU09OLnN0cmluZ2lmeShtZXNzYWdlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGRlZmF1bHRFcnJvckhhbmRsZXIoY2FsbGJhY2spIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChkYXRhLCBzdGF0dXMpIHtcbiAgICAgICAgICAgIGlmIChzdGF0dXMgPT09IDQwMSkgcmV0dXJuIGNsaWVudC5sb2dvdXQoKTtcbiAgICAgICAgICAgIGNhbGxiYWNrKG5ldyBDbGllbnRFcnJvcihzdGF0dXMsIGRhdGEpKTtcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBDbGllbnQoKSB7XG4gICAgICAgIHRoaXMuX3JlYWR5ID0gZmFsc2U7XG4gICAgICAgIHRoaXMuX2NvbmZpZ0xpc3RlbmVyID0gW107XG4gICAgICAgIHRoaXMuX3JlYWR5TGlzdGVuZXIgPSBbXTtcbiAgICAgICAgdGhpcy5fdXNlckluZm8gPSB7XG4gICAgICAgICAgICB1c2VybmFtZTogbnVsbCxcbiAgICAgICAgICAgIGVtYWlsOiBudWxsLFxuICAgICAgICAgICAgYWRtaW46IGZhbHNlXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuX3Rva2VuID0gbnVsbDtcbiAgICAgICAgdGhpcy5fY2xpZW50SWQgPSAnY2lkLXdlYmFkbWluJztcbiAgICAgICAgdGhpcy5fY2xpZW50U2VjcmV0ID0gJ3VudXNlZCc7XG4gICAgICAgIHRoaXMuX2NvbmZpZyA9IHtcbiAgICAgICAgICAgIGFwaVNlcnZlck9yaWdpbjogbnVsbCxcbiAgICAgICAgICAgIHdlYlNlcnZlck9yaWdpbjogbnVsbCxcbiAgICAgICAgICAgIGZxZG46IG51bGwsXG4gICAgICAgICAgICBpcDogbnVsbCxcbiAgICAgICAgICAgIHJldmlzaW9uOiBudWxsLFxuICAgICAgICAgICAgdXBkYXRlOiBudWxsLFxuICAgICAgICAgICAgaXNEZXY6IGZhbHNlLFxuICAgICAgICAgICAgcHJvZ3Jlc3M6IHt9XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuX2luc3RhbGxlZEFwcHMgPSBbXTtcblxuICAgICAgICB0aGlzLnNldFRva2VuKGxvY2FsU3RvcmFnZS50b2tlbik7XG4gICAgfVxuXG4gICAgQ2xpZW50LnByb3RvdHlwZS5zZXRSZWFkeSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMuX3JlYWR5KSByZXR1cm47XG5cbiAgICAgICAgdGhpcy5fcmVhZHkgPSB0cnVlO1xuICAgICAgICB0aGlzLl9yZWFkeUxpc3RlbmVyLmZvckVhY2goZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgQ2xpZW50LnByb3RvdHlwZS5vblJlYWR5ID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgICAgIGlmICh0aGlzLl9yZWFkeSkgY2FsbGJhY2soKTtcbiAgICAgICAgdGhpcy5fcmVhZHlMaXN0ZW5lci5wdXNoKGNhbGxiYWNrKTtcbiAgICB9O1xuXG4gICAgQ2xpZW50LnByb3RvdHlwZS5vbkNvbmZpZyA9IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgICAgICB0aGlzLl9jb25maWdMaXN0ZW5lci5wdXNoKGNhbGxiYWNrKTtcbiAgICAgICAgY2FsbGJhY2sodGhpcy5fY29uZmlnKTtcbiAgICB9O1xuXG4gICAgQ2xpZW50LnByb3RvdHlwZS5zZXRVc2VySW5mbyA9IGZ1bmN0aW9uICh1c2VySW5mbykge1xuICAgICAgICAvLyBJbiBvcmRlciB0byBrZWVwIHRoZSBhbmd1bGFyIGJpbmRpbmdzIGFsaXZlLCBzZXQgZWFjaCBwcm9wZXJ0eSBpbmRpdmlkdWFsbHlcbiAgICAgICAgdGhpcy5fdXNlckluZm8udXNlcm5hbWUgPSB1c2VySW5mby51c2VybmFtZTtcbiAgICAgICAgdGhpcy5fdXNlckluZm8uZW1haWwgPSB1c2VySW5mby5lbWFpbDtcbiAgICAgICAgdGhpcy5fdXNlckluZm8uYWRtaW4gPSAhIXVzZXJJbmZvLmFkbWluO1xuICAgICAgICB0aGlzLl91c2VySW5mby5ncmF2YXRhciA9ICdodHRwczovL3d3dy5ncmF2YXRhci5jb20vYXZhdGFyLycgKyBtZDUuY3JlYXRlSGFzaCh1c2VySW5mby5lbWFpbC50b0xvd2VyQ2FzZSgpKSArICcuanBnP3M9MjQmZD1tbSc7XG4gICAgfTtcblxuICAgIENsaWVudC5wcm90b3R5cGUuc2V0Q29uZmlnID0gZnVuY3Rpb24gKGNvbmZpZykge1xuICAgICAgICAvLyBJbiBvcmRlciB0byBrZWVwIHRoZSBhbmd1bGFyIGJpbmRpbmdzIGFsaXZlLCBzZXQgZWFjaCBwcm9wZXJ0eSBpbmRpdmlkdWFsbHkgKFRPRE86IGp1c3QgdXNlIGFuZ3VsYXIuY29weSA/KVxuICAgICAgICB0aGlzLl9jb25maWcuYXBpU2VydmVyT3JpZ2luID0gY29uZmlnLmFwaVNlcnZlck9yaWdpbjtcbiAgICAgICAgdGhpcy5fY29uZmlnLndlYlNlcnZlck9yaWdpbiA9IGNvbmZpZy53ZWJTZXJ2ZXJPcmlnaW47XG4gICAgICAgIHRoaXMuX2NvbmZpZy52ZXJzaW9uID0gY29uZmlnLnZlcnNpb247XG4gICAgICAgIHRoaXMuX2NvbmZpZy5mcWRuID0gY29uZmlnLmZxZG47XG4gICAgICAgIHRoaXMuX2NvbmZpZy5pcCA9IGNvbmZpZy5pcDtcbiAgICAgICAgdGhpcy5fY29uZmlnLnJldmlzaW9uID0gY29uZmlnLnJldmlzaW9uO1xuICAgICAgICB0aGlzLl9jb25maWcudXBkYXRlID0gY29uZmlnLnVwZGF0ZTtcbiAgICAgICAgdGhpcy5fY29uZmlnLmlzRGV2ID0gY29uZmlnLmlzRGV2O1xuICAgICAgICB0aGlzLl9jb25maWcucHJvZ3Jlc3MgPSBjb25maWcucHJvZ3Jlc3M7XG5cbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gICAgICAgIHRoaXMuX2NvbmZpZ0xpc3RlbmVyLmZvckVhY2goZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICBjYWxsYmFjayh0aGF0Ll9jb25maWcpO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgQ2xpZW50LnByb3RvdHlwZS5nZXRJbnN0YWxsZWRBcHBzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5faW5zdGFsbGVkQXBwcztcbiAgICB9O1xuXG4gICAgQ2xpZW50LnByb3RvdHlwZS5nZXRVc2VySW5mbyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3VzZXJJbmZvO1xuICAgIH07XG5cbiAgICBDbGllbnQucHJvdG90eXBlLmdldENvbmZpZyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NvbmZpZztcbiAgICB9O1xuXG4gICAgQ2xpZW50LnByb3RvdHlwZS5zZXRUb2tlbiA9IGZ1bmN0aW9uICh0b2tlbikge1xuICAgICAgICAkaHR0cC5kZWZhdWx0cy5oZWFkZXJzLmNvbW1vbi5BdXRob3JpemF0aW9uID0gJ0JlYXJlciAnICsgdG9rZW47XG4gICAgICAgIGlmICghdG9rZW4pIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCd0b2tlbicpO1xuICAgICAgICBlbHNlIGxvY2FsU3RvcmFnZS50b2tlbiA9IHRva2VuO1xuICAgICAgICB0aGlzLl90b2tlbiA9IHRva2VuO1xuICAgIH07XG5cbiAgICAvKlxuICAgICAqIFJlc3QgQVBJIHdyYXBwZXJzXG4gICAgICovXG4gICAgQ2xpZW50LnByb3RvdHlwZS5jb25maWcgPSBmdW5jdGlvbiAoY2FsbGJhY2spIHtcbiAgICAgICAgJGh0dHAuZ2V0KCcvYXBpL3YxL2Nsb3Vkcm9uL2NvbmZpZycpLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSwgc3RhdHVzKSB7XG4gICAgICAgICAgICBpZiAoc3RhdHVzICE9PSAyMDAgfHwgdHlwZW9mIGRhdGEgIT09ICdvYmplY3QnKSByZXR1cm4gY2FsbGJhY2sobmV3IENsaWVudEVycm9yKHN0YXR1cywgZGF0YSkpO1xuICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgZGF0YSk7XG4gICAgICAgIH0pLmVycm9yKGRlZmF1bHRFcnJvckhhbmRsZXIoY2FsbGJhY2spKTtcbiAgICB9O1xuXG4gICAgQ2xpZW50LnByb3RvdHlwZS51c2VySW5mbyA9IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgICAgICAkaHR0cC5nZXQoJy9hcGkvdjEvcHJvZmlsZScpLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSwgc3RhdHVzKSB7XG4gICAgICAgICAgICBpZiAoc3RhdHVzICE9PSAyMDAgfHwgdHlwZW9mIGRhdGEgIT09ICdvYmplY3QnKSByZXR1cm4gY2FsbGJhY2sobmV3IENsaWVudEVycm9yKHN0YXR1cywgZGF0YSkpO1xuICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgZGF0YSk7XG4gICAgICAgIH0pLmVycm9yKGRlZmF1bHRFcnJvckhhbmRsZXIoY2FsbGJhY2spKTtcbiAgICB9O1xuXG4gICAgQ2xpZW50LnByb3RvdHlwZS5pbnN0YWxsQXBwID0gZnVuY3Rpb24gKGlkLCB2ZXJzaW9uLCBwYXNzd29yZCwgdGl0bGUsIGNvbmZpZywgY2FsbGJhY2spIHtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICB2YXIgZGF0YSA9IHsgYXBwU3RvcmVJZDogaWQsIHZlcnNpb246IHZlcnNpb24sIHBhc3N3b3JkOiBwYXNzd29yZCwgbG9jYXRpb246IGNvbmZpZy5sb2NhdGlvbiwgcG9ydEJpbmRpbmdzOiBjb25maWcucG9ydEJpbmRpbmdzLCBhY2Nlc3NSZXN0cmljdGlvbjogY29uZmlnLmFjY2Vzc1Jlc3RyaWN0aW9uIH07XG4gICAgICAgICRodHRwLnBvc3QoJy9hcGkvdjEvYXBwcy9pbnN0YWxsJywgZGF0YSkuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSwgc3RhdHVzKSB7XG4gICAgICAgICAgICBpZiAoc3RhdHVzICE9PSAyMDIgfHwgdHlwZW9mIGRhdGEgIT09ICdvYmplY3QnKSByZXR1cm4gY2FsbGJhY2sobmV3IENsaWVudEVycm9yKHN0YXR1cywgZGF0YSkpO1xuXG4gICAgICAgICAgICAvLyBwdXQgbmV3IGFwcCB3aXRoIGFtZW5kZWQgdGl0bGUgaW4gY2FjaGVcbiAgICAgICAgICAgIGRhdGEubWFuaWZlc3QgPSB7IHRpdGxlOiB0aXRsZSB9O1xuICAgICAgICAgICAgdGhhdC5faW5zdGFsbGVkQXBwcy5wdXNoKGRhdGEpO1xuXG4gICAgICAgICAgICBjYWxsYmFjayhudWxsLCBkYXRhLmlkKTtcbiAgICAgICAgfSkuZXJyb3IoZGVmYXVsdEVycm9ySGFuZGxlcihjYWxsYmFjaykpO1xuICAgIH07XG5cbiAgICBDbGllbnQucHJvdG90eXBlLnVuaW5zdGFsbEFwcCA9IGZ1bmN0aW9uIChhcHBJZCwgcGFzc3dvcmQsIGNhbGxiYWNrKSB7XG4gICAgICAgIHZhciBkYXRhID0geyBwYXNzd29yZDogcGFzc3dvcmQgfTtcbiAgICAgICAgJGh0dHAucG9zdCgnL2FwaS92MS9hcHBzLycgKyBhcHBJZCArICcvdW5pbnN0YWxsJywgZGF0YSkuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSwgc3RhdHVzKSB7XG4gICAgICAgICAgICBpZiAoc3RhdHVzICE9PSAyMDIpIHJldHVybiBjYWxsYmFjayhuZXcgQ2xpZW50RXJyb3Ioc3RhdHVzLCBkYXRhKSk7XG4gICAgICAgICAgICBjYWxsYmFjayhudWxsKTtcbiAgICAgICAgfSkuZXJyb3IoZGVmYXVsdEVycm9ySGFuZGxlcihjYWxsYmFjaykpO1xuICAgIH07XG5cbiAgICBDbGllbnQucHJvdG90eXBlLmNvbmZpZ3VyZUFwcCA9IGZ1bmN0aW9uIChpZCwgcGFzc3dvcmQsIGNvbmZpZywgY2FsbGJhY2spIHtcbiAgICAgICAgdmFyIGRhdGEgPSB7IGFwcElkOiBpZCwgcGFzc3dvcmQ6IHBhc3N3b3JkLCBsb2NhdGlvbjogY29uZmlnLmxvY2F0aW9uLCBwb3J0QmluZGluZ3M6IGNvbmZpZy5wb3J0QmluZGluZ3MsIGFjY2Vzc1Jlc3RyaWN0aW9uOiBjb25maWcuYWNjZXNzUmVzdHJpY3Rpb24gfTtcbiAgICAgICAgJGh0dHAucG9zdCgnL2FwaS92MS9hcHBzLycgKyBpZCArICcvY29uZmlndXJlJywgZGF0YSkuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSwgc3RhdHVzKSB7XG4gICAgICAgICAgICBpZiAoc3RhdHVzICE9PSAyMDIpIHJldHVybiBjYWxsYmFjayhuZXcgQ2xpZW50RXJyb3Ioc3RhdHVzLCBkYXRhKSk7XG4gICAgICAgICAgICBjYWxsYmFjayhudWxsKTtcbiAgICAgICAgfSkuZXJyb3IoZGVmYXVsdEVycm9ySGFuZGxlcihjYWxsYmFjaykpO1xuICAgIH07XG5cbiAgICBDbGllbnQucHJvdG90eXBlLnVwZGF0ZUFwcCA9IGZ1bmN0aW9uIChpZCwgdmVyc2lvbiwgcGFzc3dvcmQsIGNhbGxiYWNrKSB7XG4gICAgICAgICRodHRwLnBvc3QoJy9hcGkvdjEvYXBwcy8nICsgaWQgKyAnL3VwZGF0ZScsIHsgdmVyc2lvbjogdmVyc2lvbiwgcGFzc3dvcmQ6IHBhc3N3b3JkIH0pLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEsIHN0YXR1cykge1xuICAgICAgICAgICAgaWYgKHN0YXR1cyAhPT0gMjAyKSByZXR1cm4gY2FsbGJhY2sobmV3IENsaWVudEVycm9yKHN0YXR1cywgZGF0YSkpO1xuICAgICAgICAgICAgY2FsbGJhY2sobnVsbCk7XG4gICAgICAgIH0pLmVycm9yKGRlZmF1bHRFcnJvckhhbmRsZXIoY2FsbGJhY2spKTtcbiAgICB9O1xuXG4gICAgQ2xpZW50LnByb3RvdHlwZS5zdGFydEFwcCA9IGZ1bmN0aW9uIChpZCwgY2FsbGJhY2spIHtcbiAgICAgICAgdmFyIGRhdGEgPSB7IH07XG4gICAgICAgICRodHRwLnBvc3QoJy9hcGkvdjEvYXBwcy8nICsgaWQgKyAnL3N0YXJ0JywgZGF0YSkuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSwgc3RhdHVzKSB7XG4gICAgICAgICAgICBpZiAoc3RhdHVzICE9PSAyMDIpIHJldHVybiBjYWxsYmFjayhuZXcgQ2xpZW50RXJyb3Ioc3RhdHVzLCBkYXRhKSk7XG4gICAgICAgICAgICBjYWxsYmFjayhudWxsKTtcbiAgICAgICAgfSkuZXJyb3IoZGVmYXVsdEVycm9ySGFuZGxlcihjYWxsYmFjaykpO1xuICAgIH07XG5cbiAgICBDbGllbnQucHJvdG90eXBlLnN0b3BBcHAgPSBmdW5jdGlvbiAoaWQsIGNhbGxiYWNrKSB7XG4gICAgICAgIHZhciBkYXRhID0geyB9O1xuICAgICAgICAkaHR0cC5wb3N0KCcvYXBpL3YxL2FwcHMvJyArIGlkICsgJy9zdG9wJywgZGF0YSkuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSwgc3RhdHVzKSB7XG4gICAgICAgICAgICBpZiAoc3RhdHVzICE9PSAyMDIpIHJldHVybiBjYWxsYmFjayhuZXcgQ2xpZW50RXJyb3Ioc3RhdHVzLCBkYXRhKSk7XG4gICAgICAgICAgICBjYWxsYmFjayhudWxsKTtcbiAgICAgICAgfSkuZXJyb3IoZGVmYXVsdEVycm9ySGFuZGxlcihjYWxsYmFjaykpO1xuICAgIH07XG5cbiAgICBDbGllbnQucHJvdG90eXBlLnZlcnNpb24gPSBmdW5jdGlvbiAoY2FsbGJhY2spIHtcbiAgICAgICAgJGh0dHAuZ2V0KCcvYXBpL3YxL2Nsb3Vkcm9uL3N0YXR1cycpLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSwgc3RhdHVzKSB7XG4gICAgICAgICAgICBpZiAoc3RhdHVzICE9PSAyMDAgfHwgdHlwZW9mIGRhdGEgIT09ICdvYmplY3QnKSByZXR1cm4gY2FsbGJhY2sobmV3IENsaWVudEVycm9yKHN0YXR1cywgZGF0YSkpO1xuICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgZGF0YSk7XG4gICAgICAgIH0pLmVycm9yKGRlZmF1bHRFcnJvckhhbmRsZXIoY2FsbGJhY2spKTtcbiAgICB9O1xuXG4gICAgQ2xpZW50LnByb3RvdHlwZS5pc1NlcnZlckZpcnN0VGltZSA9IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgICAgICAkaHR0cC5nZXQoJy9hcGkvdjEvY2xvdWRyb24vc3RhdHVzJykuc3VjY2VzcyhmdW5jdGlvbihkYXRhLCBzdGF0dXMpIHtcbiAgICAgICAgICAgIGlmIChzdGF0dXMgIT09IDIwMCB8fCB0eXBlb2YgZGF0YSAhPT0gJ29iamVjdCcpIHJldHVybiBjYWxsYmFjayhuZXcgQ2xpZW50RXJyb3Ioc3RhdHVzLCBkYXRhKSk7XG4gICAgICAgICAgICBjYWxsYmFjayhudWxsLCAhZGF0YS5hY3RpdmF0ZWQpO1xuICAgICAgICB9KS5lcnJvcihkZWZhdWx0RXJyb3JIYW5kbGVyKGNhbGxiYWNrKSk7XG4gICAgfTtcblxuICAgIENsaWVudC5wcm90b3R5cGUuZ2V0TmFrZWREb21haW4gPSBmdW5jdGlvbiAoY2FsbGJhY2spIHtcbiAgICAgICAgJGh0dHAuZ2V0KCcvYXBpL3YxL3NldHRpbmdzL25ha2VkX2RvbWFpbicpXG4gICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhLCBzdGF0dXMpIHtcbiAgICAgICAgICAgIGlmIChzdGF0dXMgIT09IDIwMCB8fCB0eXBlb2YgZGF0YSAhPT0gJ29iamVjdCcpIHJldHVybiBjYWxsYmFjayhuZXcgQ2xpZW50RXJyb3Ioc3RhdHVzLCBkYXRhKSk7XG4gICAgICAgICAgICBjYWxsYmFjayhudWxsLCBkYXRhLmFwcGlkKTtcbiAgICAgICAgfSkuZXJyb3IoZGVmYXVsdEVycm9ySGFuZGxlcihjYWxsYmFjaykpO1xuICAgIH07XG5cbiAgICBDbGllbnQucHJvdG90eXBlLnNldE5ha2VkRG9tYWluID0gZnVuY3Rpb24gKGFwcGlkLCBjYWxsYmFjaykge1xuICAgICAgICAkaHR0cC5wb3N0KCcvYXBpL3YxL3NldHRpbmdzL25ha2VkX2RvbWFpbicsIHsgYXBwaWQ6IGFwcGlkIH0pLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEsIHN0YXR1cykge1xuICAgICAgICAgICAgaWYgKHN0YXR1cyAhPT0gMjA0KSByZXR1cm4gY2FsbGJhY2sobmV3IENsaWVudEVycm9yKHN0YXR1cykpO1xuICAgICAgICAgICAgY2FsbGJhY2sobnVsbCk7XG4gICAgICAgIH0pLmVycm9yKGRlZmF1bHRFcnJvckhhbmRsZXIoY2FsbGJhY2spKTtcbiAgICB9O1xuXG4gICAgQ2xpZW50LnByb3RvdHlwZS5nZXRBcHBzID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgICAgICRodHRwLmdldCgnL2FwaS92MS9hcHBzJykuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSwgc3RhdHVzKSB7XG4gICAgICAgICAgICBpZiAoc3RhdHVzICE9PSAyMDAgfHwgdHlwZW9mIGRhdGEgIT09ICdvYmplY3QnKSByZXR1cm4gY2FsbGJhY2sobmV3IENsaWVudEVycm9yKHN0YXR1cywgZGF0YSkpO1xuICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgZGF0YS5hcHBzKTtcbiAgICAgICAgfSkuZXJyb3IoZGVmYXVsdEVycm9ySGFuZGxlcihjYWxsYmFjaykpO1xuICAgIH07XG5cbiAgICBDbGllbnQucHJvdG90eXBlLmdldEFwcCA9IGZ1bmN0aW9uIChhcHBJZCwgY2FsbGJhY2spIHtcbiAgICAgICAgdmFyIGFwcEZvdW5kID0gbnVsbDtcbiAgICAgICAgdGhpcy5faW5zdGFsbGVkQXBwcy5zb21lKGZ1bmN0aW9uIChhcHApIHtcbiAgICAgICAgICAgIGlmIChhcHAuaWQgPT09IGFwcElkKSB7XG4gICAgICAgICAgICAgICAgYXBwRm91bmQgPSBhcHA7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKGFwcEZvdW5kKSByZXR1cm4gY2FsbGJhY2sobnVsbCwgYXBwRm91bmQpO1xuICAgICAgICBlbHNlIHJldHVybiBjYWxsYmFjayhuZXcgRXJyb3IoJ0FwcCBub3QgZm91bmQnKSk7XG4gICAgfTtcblxuICAgIENsaWVudC5wcm90b3R5cGUuZ2V0QXBwTG9nU3RyZWFtID0gZnVuY3Rpb24gKGFwcElkKSB7XG4gICAgICAgIHZhciBzb3VyY2UgPSBuZXcgRXZlbnRTb3VyY2UoJy9hcGkvdjEvYXBwcy8nICsgYXBwSWQgKyAnL2xvZ3N0cmVhbScpO1xuICAgICAgICByZXR1cm4gc291cmNlO1xuICAgIH07XG5cbiAgICBDbGllbnQucHJvdG90eXBlLmdldEFwcExvZ1VybCA9IGZ1bmN0aW9uIChhcHBJZCkge1xuICAgICAgICByZXR1cm4gJy9hcGkvdjEvYXBwcy8nICsgYXBwSWQgKyAnL2xvZ3M/YWNjZXNzX3Rva2VuPScgKyB0aGlzLl90b2tlbjtcbiAgICB9O1xuXG4gICAgQ2xpZW50LnByb3RvdHlwZS5zZXRBZG1pbiA9IGZ1bmN0aW9uICh1c2VybmFtZSwgYWRtaW4sIGNhbGxiYWNrKSB7XG4gICAgICAgIHZhciBwYXlsb2FkID0ge1xuICAgICAgICAgICAgdXNlcm5hbWU6IHVzZXJuYW1lLFxuICAgICAgICAgICAgYWRtaW46IGFkbWluXG4gICAgICAgIH07XG5cbiAgICAgICAgJGh0dHAucG9zdCgnL2FwaS92MS91c2Vycy8nICsgdXNlcm5hbWUgKyAnL2FkbWluJywgcGF5bG9hZCkuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSwgc3RhdHVzKSB7XG4gICAgICAgICAgICBpZiAoc3RhdHVzICE9PSAyMDQpIHJldHVybiBjYWxsYmFjayhuZXcgQ2xpZW50RXJyb3Ioc3RhdHVzLCBkYXRhKSk7XG4gICAgICAgICAgICBjYWxsYmFjayhudWxsKTtcbiAgICAgICAgfSkuZXJyb3IoZGVmYXVsdEVycm9ySGFuZGxlcihjYWxsYmFjaykpO1xuICAgIH07XG5cbiAgICBDbGllbnQucHJvdG90eXBlLmNyZWF0ZUFkbWluID0gZnVuY3Rpb24gKHVzZXJuYW1lLCBwYXNzd29yZCwgZW1haWwsIHNldHVwVG9rZW4sIGNhbGxiYWNrKSB7XG4gICAgICAgIHZhciBwYXlsb2FkID0ge1xuICAgICAgICAgICAgdXNlcm5hbWU6IHVzZXJuYW1lLFxuICAgICAgICAgICAgcGFzc3dvcmQ6IHBhc3N3b3JkLFxuICAgICAgICAgICAgZW1haWw6IGVtYWlsXG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gICAgICAgICRodHRwLnBvc3QoJy9hcGkvdjEvY2xvdWRyb24vYWN0aXZhdGU/c2V0dXBUb2tlbj0nICsgc2V0dXBUb2tlbiwgcGF5bG9hZCkuc3VjY2VzcyhmdW5jdGlvbihkYXRhLCBzdGF0dXMpIHtcbiAgICAgICAgICAgIGlmIChzdGF0dXMgIT09IDIwMSB8fCB0eXBlb2YgZGF0YSAhPT0gJ29iamVjdCcpIHJldHVybiBjYWxsYmFjayhuZXcgQ2xpZW50RXJyb3Ioc3RhdHVzLCBkYXRhKSk7XG5cbiAgICAgICAgICAgIHRoYXQuc2V0VG9rZW4oZGF0YS50b2tlbik7XG4gICAgICAgICAgICB0aGF0LnNldFVzZXJJbmZvKHsgdXNlcm5hbWU6IHVzZXJuYW1lLCBlbWFpbDogZW1haWwsIGFkbWluOiB0cnVlIH0pO1xuXG4gICAgICAgICAgICBjYWxsYmFjayhudWxsLCBkYXRhLmFjdGl2YXRlZCk7XG4gICAgICAgIH0pLmVycm9yKGRlZmF1bHRFcnJvckhhbmRsZXIoY2FsbGJhY2spKTtcbiAgICB9O1xuXG4gICAgQ2xpZW50LnByb3RvdHlwZS5saXN0VXNlcnMgPSBmdW5jdGlvbiAoY2FsbGJhY2spIHtcbiAgICAgICAgJGh0dHAuZ2V0KCcvYXBpL3YxL3VzZXJzJykuc3VjY2VzcyhmdW5jdGlvbihkYXRhLCBzdGF0dXMpIHtcbiAgICAgICAgICAgIGlmIChzdGF0dXMgIT09IDIwMCB8fCB0eXBlb2YgZGF0YSAhPT0gJ29iamVjdCcpIHJldHVybiBjYWxsYmFjayhuZXcgQ2xpZW50RXJyb3Ioc3RhdHVzLCBkYXRhKSk7XG4gICAgICAgICAgICBjYWxsYmFjayhudWxsLCBkYXRhKTtcbiAgICAgICAgfSkuZXJyb3IoZGVmYXVsdEVycm9ySGFuZGxlcihjYWxsYmFjaykpO1xuICAgIH07XG5cbiAgICBDbGllbnQucHJvdG90eXBlLnN0YXRzID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgICAgICRodHRwLmdldCgnL2FwaS92MS9jbG91ZHJvbi9zdGF0cycpLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSwgc3RhdHVzKSB7XG4gICAgICAgICAgICBpZiAoc3RhdHVzICE9PSAyMDAgfHwgdHlwZW9mIGRhdGEgIT09ICdvYmplY3QnKSByZXR1cm4gY2FsbGJhY2sobmV3IENsaWVudEVycm9yKHN0YXR1cywgZGF0YSkpO1xuICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgZGF0YSk7XG4gICAgICAgIH0pLmVycm9yKGRlZmF1bHRFcnJvckhhbmRsZXIoY2FsbGJhY2spKTtcbiAgICB9O1xuXG4gICAgQ2xpZW50LnByb3RvdHlwZS5nZXRPQXV0aENsaWVudHMgPSBmdW5jdGlvbiAoY2FsbGJhY2spIHtcbiAgICAgICAgJGh0dHAuZ2V0KCcvYXBpL3YxL29hdXRoL2NsaWVudHMnKS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEsIHN0YXR1cykge1xuICAgICAgICAgICAgaWYgKHN0YXR1cyAhPT0gMjAwIHx8IHR5cGVvZiBkYXRhICE9PSAnb2JqZWN0JykgcmV0dXJuIGNhbGxiYWNrKG5ldyBDbGllbnRFcnJvcihzdGF0dXMsIGRhdGEpKTtcbiAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIGRhdGEuY2xpZW50cyk7XG4gICAgICAgIH0pLmVycm9yKGRlZmF1bHRFcnJvckhhbmRsZXIoY2FsbGJhY2spKTtcbiAgICB9O1xuXG4gICAgQ2xpZW50LnByb3RvdHlwZS5kZWxUb2tlbnNCeUNsaWVudElkID0gZnVuY3Rpb24gKGlkLCBjYWxsYmFjaykge1xuICAgICAgICAkaHR0cC5kZWxldGUoJy9hcGkvdjEvb2F1dGgvY2xpZW50cy8nICsgaWQgKyAnL3Rva2VucycpLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSwgc3RhdHVzKSB7XG4gICAgICAgICAgICBpZiAoc3RhdHVzICE9PSAyMDQpIHJldHVybiBjYWxsYmFjayhuZXcgQ2xpZW50RXJyb3Ioc3RhdHVzLCBkYXRhKSk7XG4gICAgICAgICAgICBjYWxsYmFjayhudWxsKTtcbiAgICAgICAgfSkuZXJyb3IoZGVmYXVsdEVycm9ySGFuZGxlcihjYWxsYmFjaykpO1xuICAgIH07XG5cbiAgICBDbGllbnQucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgICAgICAkaHR0cC5nZXQoJy9hcGkvdjEvY2xvdWRyb24vdXBkYXRlJykuc3VjY2VzcyhmdW5jdGlvbihkYXRhLCBzdGF0dXMpIHtcbiAgICAgICAgICAgIGlmIChzdGF0dXMgIT09IDIwMiB8fCB0eXBlb2YgZGF0YSAhPT0gJ29iamVjdCcpIHJldHVybiBjYWxsYmFjayhuZXcgQ2xpZW50RXJyb3Ioc3RhdHVzLCBkYXRhKSk7XG4gICAgICAgICAgICBjYWxsYmFjayhudWxsLCBkYXRhKTtcbiAgICAgICAgfSkuZXJyb3IoZGVmYXVsdEVycm9ySGFuZGxlcihjYWxsYmFjaykpO1xuICAgIH07XG5cbiAgICBDbGllbnQucHJvdG90eXBlLnJlYm9vdCA9IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgICAgICAkaHR0cC5nZXQoJy9hcGkvdjEvY2xvdWRyb24vcmVib290Jykuc3VjY2VzcyhmdW5jdGlvbihkYXRhLCBzdGF0dXMpIHtcbiAgICAgICAgICAgIGlmIChzdGF0dXMgIT09IDIwMiB8fCB0eXBlb2YgZGF0YSAhPT0gJ29iamVjdCcpIHJldHVybiBjYWxsYmFjayhuZXcgQ2xpZW50RXJyb3Ioc3RhdHVzLCBkYXRhKSk7XG4gICAgICAgICAgICBjYWxsYmFjayhudWxsLCBkYXRhKTtcbiAgICAgICAgfSkuZXJyb3IoZGVmYXVsdEVycm9ySGFuZGxlcihjYWxsYmFjaykpO1xuICAgIH07XG5cbiAgICBDbGllbnQucHJvdG90eXBlLmJhY2t1cCA9IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgICAgICAkaHR0cC5wb3N0KCcvYXBpL3YxL2Nsb3Vkcm9uL2JhY2t1cHMnKS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEsIHN0YXR1cykge1xuICAgICAgICAgICAgaWYgKHN0YXR1cyAhPT0gMjAyIHx8IHR5cGVvZiBkYXRhICE9PSAnb2JqZWN0JykgcmV0dXJuIGNhbGxiYWNrKG5ldyBDbGllbnRFcnJvcihzdGF0dXMsIGRhdGEpKTtcbiAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIGRhdGEpO1xuICAgICAgICB9KS5lcnJvcihkZWZhdWx0RXJyb3JIYW5kbGVyKGNhbGxiYWNrKSk7XG4gICAgfTtcblxuICAgIENsaWVudC5wcm90b3R5cGUuc2V0Q2VydGlmaWNhdGUgPSBmdW5jdGlvbiAoY2VydGlmaWNhdGVGaWxlLCBrZXlGaWxlLCBjYWxsYmFjaykge1xuICAgICAgICBjb25zb2xlLmxvZygnd2lsbCBzZXQgY2VydGlmaWNhdGUnKTtcblxuICAgICAgICB2YXIgZmQgPSBuZXcgRm9ybURhdGEoKTtcbiAgICAgICAgZmQuYXBwZW5kKCdjZXJ0aWZpY2F0ZScsIGNlcnRpZmljYXRlRmlsZSk7XG4gICAgICAgIGZkLmFwcGVuZCgna2V5Jywga2V5RmlsZSk7XG5cbiAgICAgICAgJGh0dHAucG9zdCgnL2FwaS92MS9jbG91ZHJvbi9jZXJ0aWZpY2F0ZScsIGZkLCB7XG4gICAgICAgICAgICBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiB1bmRlZmluZWQgfSxcbiAgICAgICAgICAgIHRyYW5zZm9ybVJlcXVlc3Q6IGFuZ3VsYXIuaWRlbnRpdHlcbiAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbihkYXRhLCBzdGF0dXMpIHtcbiAgICAgICAgICAgIGlmIChzdGF0dXMgIT09IDIwMikgcmV0dXJuIGNhbGxiYWNrKG5ldyBDbGllbnRFcnJvcihzdGF0dXMsIGRhdGEpKTtcbiAgICAgICAgICAgIGNhbGxiYWNrKG51bGwpO1xuICAgICAgICB9KS5lcnJvcihkZWZhdWx0RXJyb3JIYW5kbGVyKGNhbGxiYWNrKSk7XG4gICAgfTtcblxuICAgIENsaWVudC5wcm90b3R5cGUuZ3JhcGhzID0gZnVuY3Rpb24gKHRhcmdldHMsIGZyb20sIGNhbGxiYWNrKSB7XG4gICAgICAgIHZhciBjb25maWcgPSB7XG4gICAgICAgICAgICBwYXJhbXM6IHtcbiAgICAgICAgICAgICAgICB0YXJnZXQ6IHRhcmdldHMsXG4gICAgICAgICAgICAgICAgZm9ybWF0OiAnanNvbicsXG4gICAgICAgICAgICAgICAgZnJvbTogZnJvbVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgICRodHRwLmdldCgnL2FwaS92MS9jbG91ZHJvbi9ncmFwaHMnLCBjb25maWcpLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEsIHN0YXR1cykge1xuICAgICAgICAgICAgaWYgKHN0YXR1cyAhPT0gMjAwIHx8IHR5cGVvZiBkYXRhICE9PSAnb2JqZWN0JykgcmV0dXJuIGNhbGxiYWNrKG5ldyBDbGllbnRFcnJvcihzdGF0dXMsIGRhdGEpKTtcbiAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIGRhdGEpO1xuICAgICAgICB9KS5lcnJvcihkZWZhdWx0RXJyb3JIYW5kbGVyKGNhbGxiYWNrKSk7XG4gICAgfTtcblxuICAgIENsaWVudC5wcm90b3R5cGUuY3JlYXRlVXNlciA9IGZ1bmN0aW9uICh1c2VybmFtZSwgZW1haWwsIGNhbGxiYWNrKSB7XG4gICAgICAgIHZhciBkYXRhID0ge1xuICAgICAgICAgICAgdXNlcm5hbWU6IHVzZXJuYW1lLFxuICAgICAgICAgICAgZW1haWw6IGVtYWlsXG4gICAgICAgIH07XG5cbiAgICAgICAgJGh0dHAucG9zdCgnL2FwaS92MS91c2VycycsIGRhdGEpLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSwgc3RhdHVzKSB7XG4gICAgICAgICAgICBpZiAoc3RhdHVzICE9PSAyMDEgfHwgdHlwZW9mIGRhdGEgIT09ICdvYmplY3QnKSByZXR1cm4gY2FsbGJhY2sobmV3IENsaWVudEVycm9yKHN0YXR1cywgZGF0YSkpO1xuICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgZGF0YSk7XG4gICAgICAgIH0pLmVycm9yKGRlZmF1bHRFcnJvckhhbmRsZXIoY2FsbGJhY2spKTtcbiAgICB9O1xuXG4gICAgQ2xpZW50LnByb3RvdHlwZS5yZW1vdmVVc2VyID0gZnVuY3Rpb24gKHVzZXJuYW1lLCBwYXNzd29yZCwgY2FsbGJhY2spIHtcbiAgICAgICAgdmFyIGRhdGEgPSB7XG4gICAgICAgICAgICB1c2VybmFtZTogdXNlcm5hbWUsXG4gICAgICAgICAgICBwYXNzd29yZDogcGFzc3dvcmRcbiAgICAgICAgfTtcblxuICAgICAgICAkaHR0cCh7IG1ldGhvZDogJ0RFTEVURScsIHVybDogJy9hcGkvdjEvdXNlcnMvJyArIHVzZXJuYW1lLCBkYXRhOiBkYXRhLCBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicgfX0pLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSwgc3RhdHVzKSB7XG4gICAgICAgICAgICBpZiAoc3RhdHVzICE9PSAyMDQpIHJldHVybiBjYWxsYmFjayhuZXcgQ2xpZW50RXJyb3Ioc3RhdHVzLCBkYXRhKSk7XG4gICAgICAgICAgICBjYWxsYmFjayhudWxsKTtcbiAgICAgICAgfSkuZXJyb3IoZGVmYXVsdEVycm9ySGFuZGxlcihjYWxsYmFjaykpO1xuICAgIH07XG5cbiAgICBDbGllbnQucHJvdG90eXBlLmNoYW5nZVBhc3N3b3JkID0gZnVuY3Rpb24gKGN1cnJlbnRQYXNzd29yZCwgbmV3UGFzc3dvcmQsIGNhbGxiYWNrKSB7XG4gICAgICAgIHZhciBkYXRhID0ge1xuICAgICAgICAgICAgcGFzc3dvcmQ6IGN1cnJlbnRQYXNzd29yZCxcbiAgICAgICAgICAgIG5ld1Bhc3N3b3JkOiBuZXdQYXNzd29yZFxuICAgICAgICB9O1xuXG4gICAgICAgICRodHRwLnBvc3QoJy9hcGkvdjEvdXNlcnMvJyArIHRoaXMuX3VzZXJJbmZvLnVzZXJuYW1lICsgJy9wYXNzd29yZCcsIGRhdGEpLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSwgc3RhdHVzKSB7XG4gICAgICAgICAgICBpZiAoc3RhdHVzICE9PSAyMDQgfHwgdHlwZW9mIGRhdGEgIT09ICdvYmplY3QnKSByZXR1cm4gY2FsbGJhY2sobmV3IENsaWVudEVycm9yKHN0YXR1cywgZGF0YSkpO1xuICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgZGF0YSk7XG4gICAgICAgIH0pLmVycm9yKGRlZmF1bHRFcnJvckhhbmRsZXIoY2FsbGJhY2spKTtcbiAgICB9O1xuXG4gICAgQ2xpZW50LnByb3RvdHlwZS5yZWZyZXNoQ29uZmlnID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcblxuICAgICAgICBjYWxsYmFjayA9IHR5cGVvZiBjYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJyA/IGNhbGxiYWNrIDogZnVuY3Rpb24gKCkge307XG5cbiAgICAgICAgdGhpcy5jb25maWcoZnVuY3Rpb24gKGVycm9yLCByZXN1bHQpIHtcbiAgICAgICAgICAgIGlmIChlcnJvcikgcmV0dXJuIGNhbGxiYWNrKGVycm9yKTtcblxuICAgICAgICAgICAgdGhhdC5zZXRDb25maWcocmVzdWx0KTtcbiAgICAgICAgICAgIGNhbGxiYWNrKG51bGwpO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgQ2xpZW50LnByb3RvdHlwZS5yZWZyZXNoSW5zdGFsbGVkQXBwcyA9IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG5cbiAgICAgICAgY2FsbGJhY2sgPSB0eXBlb2YgY2FsbGJhY2sgPT09ICdmdW5jdGlvbicgPyBjYWxsYmFjayA6IGZ1bmN0aW9uICgpIHt9O1xuXG4gICAgICAgIHRoaXMuZ2V0QXBwcyhmdW5jdGlvbiAoZXJyb3IsIGFwcHMpIHtcbiAgICAgICAgICAgIGlmIChlcnJvcikgcmV0dXJuIGNhbGxiYWNrKGVycm9yKTtcblxuICAgICAgICAgICAgLy8gaW5zZXJ0IG9yIHVwZGF0ZSBuZXcgYXBwc1xuICAgICAgICAgICAgYXBwcy5mb3JFYWNoKGZ1bmN0aW9uIChhcHApIHtcbiAgICAgICAgICAgICAgICB2YXIgZm91bmQgPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhhdC5faW5zdGFsbGVkQXBwcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhhdC5faW5zdGFsbGVkQXBwc1tpXS5pZCA9PT0gYXBwLmlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3VuZCA9IGk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChmb3VuZCAhPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5jb3B5KGFwcCwgdGhhdC5faW5zdGFsbGVkQXBwc1tmb3VuZF0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuX2luc3RhbGxlZEFwcHMucHVzaChhcHApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBmaWx0ZXIgb3V0IG9sZCBlbnRyaWVzLCBnb2luZyBiYWNrd2FyZHMgdG8gYWxsb3cgc3BsaWNpbmdcbiAgICAgICAgICAgIGZvcih2YXIgaSA9IHRoYXQuX2luc3RhbGxlZEFwcHMubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHtcbiAgICAgICAgICAgICAgICBpZiAoIWFwcHMuc29tZShmdW5jdGlvbiAoZWxlbSkgeyByZXR1cm4gKGVsZW0uaWQgPT09IHRoYXQuX2luc3RhbGxlZEFwcHNbaV0uaWQpOyB9KSkge1xuICAgICAgICAgICAgICAgICAgICB0aGF0Ll9pbnN0YWxsZWRBcHBzLnNwbGljZShpLCAxKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY2FsbGJhY2sobnVsbCk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBDbGllbnQucHJvdG90eXBlLmxvZ291dCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5zZXRUb2tlbihudWxsKTtcbiAgICAgICAgdGhpcy5fdXNlckluZm8gPSB7fTtcblxuICAgICAgICAvLyBsb2dvdXQgZnJvbSBPQXV0aCBzZXNzaW9uXG4gICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJy9hcGkvdjEvc2Vzc2lvbi9sb2dvdXQnO1xuICAgIH07XG5cbiAgICBDbGllbnQucHJvdG90eXBlLmV4Y2hhbmdlQ29kZUZvclRva2VuID0gZnVuY3Rpb24gKGF1dGhDb2RlLCBjYWxsYmFjaykge1xuICAgICAgICB2YXIgZGF0YSA9IHtcbiAgICAgICAgICAgIGdyYW50X3R5cGU6ICdhdXRob3JpemF0aW9uX2NvZGUnLFxuICAgICAgICAgICAgY29kZTogYXV0aENvZGUsXG4gICAgICAgICAgICByZWRpcmVjdF91cmk6IHdpbmRvdy5sb2NhdGlvbi5vcmlnaW4sXG4gICAgICAgICAgICBjbGllbnRfaWQ6IHRoaXMuX2NsaWVudElkLFxuICAgICAgICAgICAgY2xpZW50X3NlY3JldDogdGhpcy5fY2xpZW50U2VjcmV0XG4gICAgICAgIH07XG5cbiAgICAgICAgJGh0dHAucG9zdCgnL2FwaS92MS9vYXV0aC90b2tlbj9yZXNwb25zZV90eXBlPXRva2VuJmNsaWVudF9pZD0nICsgdGhpcy5fY2xpZW50SWQsIGRhdGEpLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSwgc3RhdHVzKSB7XG4gICAgICAgICAgICBpZiAoc3RhdHVzICE9PSAyMDAgfHwgdHlwZW9mIGRhdGEgIT09ICdvYmplY3QnKSByZXR1cm4gY2FsbGJhY2sobmV3IENsaWVudEVycm9yKHN0YXR1cywgZGF0YSkpO1xuXG4gICAgICAgICAgICBjYWxsYmFjayhudWxsLCBkYXRhLmFjY2Vzc190b2tlbik7XG4gICAgICAgIH0pLmVycm9yKGRlZmF1bHRFcnJvckhhbmRsZXIoY2FsbGJhY2spKTtcbiAgICB9O1xuXG4gICAgY2xpZW50ID0gbmV3IENsaWVudCgpO1xuICAgIHJldHVybiBjbGllbnQ7XG59XSk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=