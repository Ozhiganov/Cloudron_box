<!DOCTYPE html>
<html lang="en">
<head>
  <title> Welcome to Yellow Tent </title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">
  <link href="bootstrap/css/bootstrap-theme.min.css" rel="stylesheet" media="screen">
  <link href="bootstrap-glyphicons-gh-pages/css/bootstrap-glyphicons.css" rel="stylesheet" media="screen">
</head>

<body>
  <div class="navbar">
    <img width="48px" src="/assets/yellow_tent.png"/>
    <a href="#" class="navbar-brand">Yellow Tent</a>

    <div class="navbar-text pull-right dropdown">
      <a class="navbar-link" data-toggle="dropdown" href="#">
        <span id="user-dropdown-trigger">Signed in as</span>
        <b class="caret"></b>
      </a>
      <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
        <li><a tabindex="-1" href="#">Preferences</a></li>
        <li class="divider"></li>
        <li><a tabindex="-1" href="#" id="logout-button">Sign out</a></li>
      </ul>
    </div>  <!-- signed-in dropdown -->
  </div> <!-- navbar -->

  <div class="container">
    <ul class="nav nav-pills nav-justified">
      <li id="home-link"><a href="#home">Home</a></li>
      <li id="devices-link"><a href="#devices">My Devices</a></li>
      <li id="files-link"><a href="#files">Files</a></li>
      <li id="usersgroups-link"><a href="#usersgroups">Users &amp; Groups</a></li>
      <li id="logs-link"><a href="#logs">Logs</a></li>
    </ul>
  </div> <!-- container -->

  <div class="container">
    <div id="home-container" class="container hide">
      Home
    </div>

    <div id="devices-container" class="container hide">
      My Devices
    </div>

    <div id="files-container" class="container hide">
      <legend>Volumes<button id="new-volume-button" class="btn btn-xs pull-right">Create new Volume</button></legend>
      <div id="volume-list-container" class="container"></div>

      <legend>Files</legend>
      <div id="file-list-container" class="container"></div>
    </div>

    <div id="usersgroups-container" class="container hide">
      Users &amp; Groups
    </div>

    <div id="logs-container" class="container hide">
      Logs
    </div>
  </div>

  <div id="password-dialog" class="modal fade">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          <h4 class="modal-title">Authorization</h4>
        </div>
        <div class="modal-body">
          <form id="password-dialog-form" class="form-horizontal" action="" autocomplete="off">
            <div class="form-group">
              <label for="password" class="col-lg-2 control-label">Password</label>
              <div class="col-lg-10">
                <input type="password" class="form-control" id="password" placeholder="Password" name="password">
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default btn-primary" data-dismiss="modal">Cancel</button>
          <button type="button" id="password-dialog-ok-button" class="btn btn-default btn-primary">OK</button>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->

  <div id="new-volume-dialog" class="modal fade">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          <h4 class="modal-title">Create New Volume</h4>
        </div>
        <div class="modal-body">
          <form id="new-volume-dialog-form" class="form-horizontal" action="/api/v1/volume/create" autocomplete="off">
            <div class="form-group">
              <label for="name" class="col-lg-2 control-label">Volume Name</label>
              <div class="col-lg-10">
                <input type="text" class="form-control" id="name" placeholder="Name" name="name">
              </div>
            </div>
            <div class="form-group">
              <label for="password" class="col-lg-2 control-label">Password</label>
              <div class="col-lg-10">
                <input type="password" class="form-control" id="password" placeholder="Password" name="password">
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default btn-primary" data-dismiss="modal">Cancel</button>
          <button type="button" id="new-volume-dialog-ok-button" class="btn btn-default btn-primary">OK</button>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->

  <div id="modalDialog" class="modal fade">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          <h4 class="modal-title">Title</h4>
        </div>
        <div class="modal-body">
          <p>Body</p>
          <div class="progress progress-striped active">
            <div class="progress-bar" style="width: 100%"></div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" id="button1" class="btn btn-default btn-primary" data-dismiss="modal">OK</button>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->

  <script src="jquery/jquery.js"></script>
  <script src="jquery/jquery.base64.min.js"></script>
  <script src="jquery/jquery.cookie.js"></script>
  <script src="bootstrap/js/bootstrap.min.js"></script>
  <script src="util.js"></script>
  <script src="volume-client.js"></script>

  <script>

    $(document).ready(function () {
      var token;
      var currentView;

      // global yellowtent object to share data
      window.yellowtent = {};

      // check for token to proceed
      token = $.cookie('token');
      if (!token) {
        window.location.replace('index.html');
      }


      // select current view - if window.location.hash is set it already contains the # to reference with jquery
      function updateCurrentView() {
        var view = window.location.hash ? window.location.hash.slice(1) : "home";

        if (currentView === view) {
          return;
        }

        if (currentView) {
          document.getElementById(currentView + "-container").classList.add("hide");
          document.getElementById(currentView + "-link").classList.remove("active");
        }

        currentView = view;
        document.getElementById(currentView + "-container").classList.remove("hide");
        document.getElementById(currentView + "-link").classList.add("active");
      }


      // update view according to the current hash
      updateCurrentView();
      getVolumeListing();


      // get user info to update avatar ui
      $.getJSON('/api/v1/user/info', function (data) {
          $("#user-dropdown-trigger").text("Signed in as " + data.username);
          window.yellowtent.username = data.username;
      }).fail(function(error) {
        console.error('Unable to get username.', error);
          $("#user-dropdown-trigger").text("Invalid user");
      });


      // setup event handler
      window.onhashchange = function hashChangeListener(e) {
        updateCurrentView();
      }

      // setup onclick handler
      $('#logout-button').click(function (event) {
        $.get('/api/v1/logout', function (data) {}).always(function() {
          $.removeCookie('token');
          window.location.href = "index.html";
        });
      });

      // create new volume handling
      $("#new-volume-button").click(function (event) {
        $("#new-volume-dialog").modal();
      });

      $('#new-volume-dialog-form').submit(createVolume);

      $('#new-volume-dialog-ok-button').on('click', function(e){
        e.preventDefault();
        $('#new-volume-dialog-form').submit();
      });
    });
  </script>

</body>

</html>
