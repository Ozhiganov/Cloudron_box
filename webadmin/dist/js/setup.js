"use strict";var app=angular.module("Application",["ngAnimate","angular-md5"]);app.controller("SetupController",["$scope","Client",function(t,e){t.initialized=!1,t.busy=!1,t.username="",t.email="",t.password="",t.passwordRepeat="",t.error="",t.submit=function(){t.busy=!0,t.error="",e.createAdmin(t.username,t.password,t.email,function(e){return e?(t.error=e.message,console.error("Internal error",e),void(t.busy=!1)):void(window.location.href="/")})},e.isServerFirstTime(function(e,n){return e?void(window.location.href="/error.html"):n?(t.initialized=!0,void setTimeout(function(){$("input[autofocus]:visible:first").focus()},0)):void(window.location.href="/")})}]),angular.module("Application").service("Client",["$http","md5",function(t,e){function n(t,e){Error.call(this),this.name=this.constructor.name,this.statusCode=t,this.message="string"==typeof e?e:JSON.stringify(e)}function o(t){return function(e,o){return 401===o?i.logout():void t(new n(o,e))}}function r(){this._ready=!1,this._configListener=[],this._readyListener=[],this._userInfo={username:null,email:null,admin:!1},this._token=null,this._clientId="cid-webadmin",this._clientSecret="unused",this._config={apiServerOrigin:null,webServerOrigin:null,fqdn:null,ip:null,revision:null,update:null,isDev:!1,progress:{}},this._installedApps=[],this.setToken(localStorage.token)}var i=null;return r.prototype.setReady=function(){this._ready||(this._ready=!0,this._readyListener.forEach(function(t){t()}))},r.prototype.onReady=function(t){this._ready&&t(),this._readyListener.push(t)},r.prototype.onConfig=function(t){this._configListener.push(t),t(this._config)},r.prototype.setUserInfo=function(t){this._userInfo.username=t.username,this._userInfo.email=t.email,this._userInfo.admin=!!t.admin,this._userInfo.gravatar="https://www.gravatar.com/avatar/"+e.createHash(t.email.toLowerCase())+".jpg?s=24&d=mm"},r.prototype.setConfig=function(t){this._config.apiServerOrigin=t.apiServerOrigin,this._config.webServerOrigin=t.webServerOrigin,this._config.version=t.version,this._config.fqdn=t.fqdn,this._config.ip=t.ip,this._config.revision=t.revision,this._config.update=t.update,this._config.isDev=t.isDev,this._config.progress=t.progress;var e=this;this._configListener.forEach(function(t){t(e._config)})},r.prototype.getInstalledApps=function(){return this._installedApps},r.prototype.getUserInfo=function(){return this._userInfo},r.prototype.getConfig=function(){return this._config},r.prototype.setToken=function(e){t.defaults.headers.common.Authorization="Bearer "+e,e?localStorage.token=e:localStorage.removeItem("token"),this._token=e},r.prototype.config=function(e){t.get("/api/v1/cloudron/config").success(function(t,o){return 200!==o||"object"!=typeof t?e(new n(o,t)):void e(null,t)}).error(o(e))},r.prototype.userInfo=function(e){t.get("/api/v1/profile").success(function(t,o){return 200!==o||"object"!=typeof t?e(new n(o,t)):void e(null,t)}).error(o(e))},r.prototype.installApp=function(e,r,i,s,p,u){var c=this,a={appStoreId:e,version:r,password:i,location:p.location,portBindings:p.portBindings,accessRestriction:p.accessRestriction};t.post("/api/v1/apps/install",a).success(function(t,e){return 202!==e||"object"!=typeof t?u(new n(e,t)):(t.manifest={title:s},c._installedApps.push(t),void u(null,t.id))}).error(o(u))},r.prototype.configureApp=function(e,r,i,s){var p={appId:e,password:r,location:i.location,portBindings:i.portBindings,accessRestriction:i.accessRestriction};t.post("/api/v1/apps/"+e+"/configure",p).success(function(t,e){return 202!==e?s(new n(e,t)):void s(null)}).error(o(s))},r.prototype.updateApp=function(e,r,i){t.post("/api/v1/apps/"+e+"/update",{version:r}).success(function(t,e){return 202!==e?i(new n(e,t)):void i(null)}).error(o(i))},r.prototype.startApp=function(e,r){var i={};t.post("/api/v1/apps/"+e+"/start",i).success(function(t,e){return 202!==e?r(new n(e,t)):void r(null)}).error(o(r))},r.prototype.stopApp=function(e,r){var i={};t.post("/api/v1/apps/"+e+"/stop",i).success(function(t,e){return 202!==e?r(new n(e,t)):void r(null)}).error(o(r))},r.prototype.version=function(e){t.get("/api/v1/cloudron/status").success(function(t,o){return 200!==o||"object"!=typeof t?e(new n(o,t)):void e(null,t)}).error(o(e))},r.prototype.isServerFirstTime=function(e){t.get("/api/v1/cloudron/status").success(function(t,o){return 200!==o||"object"!=typeof t?e(new n(o,t)):void e(null,!t.activated)}).error(o(e))},r.prototype.getNakedDomain=function(e){t.get("/api/v1/settings/naked_domain").success(function(t,o){return 200!==o||"object"!=typeof t?e(new n(o,t)):void e(null,t.appid)}).error(o(e))},r.prototype.setNakedDomain=function(e,r){t.post("/api/v1/settings/naked_domain",{appid:e}).success(function(t,e){return 204!==e?r(new n(e)):void r(null)}).error(o(r))},r.prototype.getApps=function(e){t.get("/api/v1/apps").success(function(t,o){return 200!==o||"object"!=typeof t?e(new n(o,t)):void e(null,t.apps)}).error(o(e))},r.prototype.getApp=function(t,e){var n=null;return this._installedApps.some(function(e){return e.id===t?(n=e,!0):!1}),n?e(null,n):e(new Error("App not found"))},r.prototype.uninstallApp=function(e,r){t.post("/api/v1/apps/"+e+"/uninstall").success(function(t,e){return 202!==e?r(new n(e,t)):void r(null)}).error(o(r))},r.prototype.getAppLogStream=function(t){var e=new EventSource("/api/v1/apps/"+t+"/logstream");return e},r.prototype.getAppLogUrl=function(t){return"/api/v1/apps/"+t+"/logs?access_token="+this._token},r.prototype.setAdmin=function(e,r,i){var s={username:e,admin:r};t.post("/api/v1/users/"+e+"/admin",s).success(function(t,e){return 204!==e?i(new n(e,t)):void i(null)}).error(o(i))},r.prototype.createAdmin=function(e,r,i,s){var p={username:e,password:r,email:i},u=this;t.post("/api/v1/cloudron/activate",p).success(function(t,o){return 201!==o||"object"!=typeof t?s(new n(o,t)):(u.setToken(t.token),u.setUserInfo({username:e,email:i,admin:!0}),void s(null,t.activated))}).error(o(s))},r.prototype.listUsers=function(e){t.get("/api/v1/users").success(function(t,o){return 200!==o||"object"!=typeof t?e(new n(o,t)):void e(null,t)}).error(o(e))},r.prototype.stats=function(e){t.get("/api/v1/cloudron/stats").success(function(t,o){return 200!==o||"object"!=typeof t?e(new n(o,t)):void e(null,t)}).error(o(e))},r.prototype.getOAuthClients=function(e){t.get("/api/v1/oauth/clients").success(function(t,o){return 200!==o||"object"!=typeof t?e(new n(o,t)):void e(null,t.clients)}).error(o(e))},r.prototype.delTokensByClientId=function(e,r){t["delete"]("/api/v1/oauth/clients/"+e+"/tokens").success(function(t,e){return 204!==e?r(new n(e,t)):void r(null)}).error(o(r))},r.prototype.update=function(e){t.get("/api/v1/cloudron/update").success(function(t,o){return 202!==o||"object"!=typeof t?e(new n(o,t)):void e(null,t)}).error(o(e))},r.prototype.reboot=function(e){t.get("/api/v1/cloudron/reboot").success(function(t,o){return 202!==o||"object"!=typeof t?e(new n(o,t)):void e(null,t)}).error(o(e))},r.prototype.backup=function(e){t.post("/api/v1/cloudron/backups").success(function(t,o){return 202!==o||"object"!=typeof t?e(new n(o,t)):void e(null,t)}).error(o(e))},r.prototype.setCertificate=function(e,r,i){console.log("will set certificate");var s=new FormData;s.append("certificate",e),s.append("key",r),t.post("/api/v1/cloudron/certificate",s,{headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(function(t,e){return 202!==e?i(new n(e,t)):void i(null)}).error(o(i))},r.prototype.graphs=function(e,r,i){var s={params:{target:e,format:"json",from:r}};t.get("/api/v1/cloudron/graphs",s).success(function(t,e){return 200!==e||"object"!=typeof t?i(new n(e,t)):void i(null,t)}).error(o(i))},r.prototype.createUser=function(e,r,i){var s={username:e,email:r};t.post("/api/v1/users",s).success(function(t,e){return 201!==e||"object"!=typeof t?i(new n(e,t)):void i(null,t)}).error(o(i))},r.prototype.removeUser=function(e,r,i){var s={username:e,password:r};t({method:"DELETE",url:"/api/v1/users/"+e,data:s,headers:{"Content-Type":"application/json"}}).success(function(t,e){return 204!==e?i(new n(e,t)):void i(null)}).error(o(i))},r.prototype.changePassword=function(e,r,i){var s={password:e,newPassword:r};t.post("/api/v1/users/"+this._userInfo.username+"/password",s).success(function(t,e){return 204!==e||"object"!=typeof t?i(new n(e,t)):void i(null,t)}).error(o(i))},r.prototype.refreshConfig=function(t){var e=this;t="function"==typeof t?t:function(){},this.config(function(n,o){return n?t(n):(e.setConfig(o),void t(null))})},r.prototype.refreshInstalledApps=function(t){var e=this;t="function"==typeof t?t:function(){},this.getApps(function(n,o){if(n)return t(n);o.forEach(function(t){for(var n=!1,o=0;o<e._installedApps.length;++o)if(e._installedApps[o].id===t.id){n=o;break}n!==!1?angular.copy(t,e._installedApps[n]):e._installedApps.push(t)});for(var r=e._installedApps.length-1;r>=0;--r)o.some(function(t){return t.id===e._installedApps[r].id})||e._installedApps.splice(r,1);t(null)})},r.prototype.logout=function(){this.setToken(null),this._userInfo={},window.location.href="/api/v1/session/logout"},r.prototype.exchangeCodeForToken=function(e,r){var i={grant_type:"authorization_code",code:e,redirect_uri:window.location.origin,client_id:this._clientId,client_secret:this._clientSecret};t.post("/api/v1/oauth/token?response_type=token&client_id="+this._clientId,i).success(function(t,e){return 200!==e||"object"!=typeof t?r(new n(e,t)):void r(null,t.access_token)}).error(o(r))},i=new r}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNldHVwLmpzIiwiY2xpZW50LmpzIl0sIm5hbWVzIjpbImFwcCIsImFuZ3VsYXIiLCJtb2R1bGUiLCJjb250cm9sbGVyIiwiJHNjb3BlIiwiQ2xpZW50IiwiaW5pdGlhbGl6ZWQiLCJidXN5IiwidXNlcm5hbWUiLCJlbWFpbCIsInBhc3N3b3JkIiwicGFzc3dvcmRSZXBlYXQiLCJlcnJvciIsInN1Ym1pdCIsImNyZWF0ZUFkbWluIiwibWVzc2FnZSIsImNvbnNvbGUiLCJ3aW5kb3ciLCJsb2NhdGlvbiIsImhyZWYiLCJpc1NlcnZlckZpcnN0VGltZSIsImlzRmlyc3RUaW1lIiwic2V0VGltZW91dCIsIiQiLCJmb2N1cyIsInNlcnZpY2UiLCIkaHR0cCIsIm1kNSIsIkNsaWVudEVycm9yIiwic3RhdHVzQ29kZSIsIkVycm9yIiwiY2FsbCIsInRoaXMiLCJuYW1lIiwiY29uc3RydWN0b3IiLCJKU09OIiwic3RyaW5naWZ5IiwiZGVmYXVsdEVycm9ySGFuZGxlciIsImNhbGxiYWNrIiwiZGF0YSIsInN0YXR1cyIsImNsaWVudCIsImxvZ291dCIsIl9yZWFkeSIsIl9jb25maWdMaXN0ZW5lciIsIl9yZWFkeUxpc3RlbmVyIiwiX3VzZXJJbmZvIiwiYWRtaW4iLCJfdG9rZW4iLCJfY2xpZW50SWQiLCJfY2xpZW50U2VjcmV0IiwiX2NvbmZpZyIsImFwaVNlcnZlck9yaWdpbiIsIndlYlNlcnZlck9yaWdpbiIsImZxZG4iLCJpcCIsInJldmlzaW9uIiwidXBkYXRlIiwiaXNEZXYiLCJwcm9ncmVzcyIsIl9pbnN0YWxsZWRBcHBzIiwic2V0VG9rZW4iLCJsb2NhbFN0b3JhZ2UiLCJ0b2tlbiIsInByb3RvdHlwZSIsInNldFJlYWR5IiwiZm9yRWFjaCIsIm9uUmVhZHkiLCJwdXNoIiwib25Db25maWciLCJzZXRVc2VySW5mbyIsInVzZXJJbmZvIiwiZ3JhdmF0YXIiLCJjcmVhdGVIYXNoIiwidG9Mb3dlckNhc2UiLCJzZXRDb25maWciLCJjb25maWciLCJ2ZXJzaW9uIiwidGhhdCIsImdldEluc3RhbGxlZEFwcHMiLCJnZXRVc2VySW5mbyIsImdldENvbmZpZyIsImRlZmF1bHRzIiwiaGVhZGVycyIsImNvbW1vbiIsIkF1dGhvcml6YXRpb24iLCJyZW1vdmVJdGVtIiwiZ2V0Iiwic3VjY2VzcyIsImluc3RhbGxBcHAiLCJpZCIsInRpdGxlIiwiYXBwU3RvcmVJZCIsInBvcnRCaW5kaW5ncyIsImFjY2Vzc1Jlc3RyaWN0aW9uIiwicG9zdCIsIm1hbmlmZXN0IiwiY29uZmlndXJlQXBwIiwiYXBwSWQiLCJ1cGRhdGVBcHAiLCJzdGFydEFwcCIsInN0b3BBcHAiLCJhY3RpdmF0ZWQiLCJnZXROYWtlZERvbWFpbiIsImFwcGlkIiwic2V0TmFrZWREb21haW4iLCJnZXRBcHBzIiwiYXBwcyIsImdldEFwcCIsImFwcEZvdW5kIiwic29tZSIsInVuaW5zdGFsbEFwcCIsImdldEFwcExvZ1N0cmVhbSIsInNvdXJjZSIsIkV2ZW50U291cmNlIiwiZ2V0QXBwTG9nVXJsIiwic2V0QWRtaW4iLCJwYXlsb2FkIiwibGlzdFVzZXJzIiwic3RhdHMiLCJnZXRPQXV0aENsaWVudHMiLCJjbGllbnRzIiwiZGVsVG9rZW5zQnlDbGllbnRJZCIsInJlYm9vdCIsImJhY2t1cCIsInNldENlcnRpZmljYXRlIiwiY2VydGlmaWNhdGVGaWxlIiwia2V5RmlsZSIsImxvZyIsImZkIiwiRm9ybURhdGEiLCJhcHBlbmQiLCJDb250ZW50LVR5cGUiLCJ1bmRlZmluZWQiLCJ0cmFuc2Zvcm1SZXF1ZXN0IiwiaWRlbnRpdHkiLCJncmFwaHMiLCJ0YXJnZXRzIiwiZnJvbSIsInBhcmFtcyIsInRhcmdldCIsImZvcm1hdCIsImNyZWF0ZVVzZXIiLCJyZW1vdmVVc2VyIiwibWV0aG9kIiwidXJsIiwiY2hhbmdlUGFzc3dvcmQiLCJjdXJyZW50UGFzc3dvcmQiLCJuZXdQYXNzd29yZCIsInJlZnJlc2hDb25maWciLCJyZXN1bHQiLCJyZWZyZXNoSW5zdGFsbGVkQXBwcyIsImZvdW5kIiwiaSIsImxlbmd0aCIsImNvcHkiLCJlbGVtIiwic3BsaWNlIiwiZXhjaGFuZ2VDb2RlRm9yVG9rZW4iLCJhdXRoQ29kZSIsImdyYW50X3R5cGUiLCJjb2RlIiwicmVkaXJlY3RfdXJpIiwib3JpZ2luIiwiY2xpZW50X2lkIiwiY2xpZW50X3NlY3JldCIsImFjY2Vzc190b2tlbiJdLCJtYXBwaW5ncyI6IkFBQUEsWUFHQSxJQUFBQSxLQUFBQyxRQUFBQyxPQUFBLGVBQUEsWUFBQSxlQUVBRixLQUFBRyxXQUFBLG1CQUFBLFNBQUEsU0FBQSxTQUFBQyxFQUFBQyxHQUNBRCxFQUFBRSxhQUFBLEVBQ0FGLEVBQUFHLE1BQUEsRUFFQUgsRUFBQUksU0FBQSxHQUNBSixFQUFBSyxNQUFBLEdBQ0FMLEVBQUFNLFNBQUEsR0FDQU4sRUFBQU8sZUFBQSxHQUVBUCxFQUFBUSxNQUFBLEdBRUFSLEVBQUFTLE9BQUEsV0FDQVQsRUFBQUcsTUFBQSxFQUNBSCxFQUFBUSxNQUFBLEdBRUFQLEVBQUFTLFlBQUFWLEVBQUFJLFNBQUFKLEVBQUFNLFNBQUFOLEVBQUFLLE1BQUEsU0FBQUcsR0FDQSxNQUFBQSxJQUNBUixFQUFBUSxNQUFBQSxFQUFBRyxRQUNBQyxRQUFBSixNQUFBLGlCQUFBQSxRQUVBUixFQUFBRyxNQUFBLFNBSUFVLE9BQUFDLFNBQUFDLEtBQUEsUUFJQWQsRUFBQWUsa0JBQUEsU0FBQVIsRUFBQVMsR0FDQSxNQUFBVCxRQUNBSyxPQUFBQyxTQUFBQyxLQUFBLGVBSUFFLEdBS0FqQixFQUFBRSxhQUFBLE1BR0FnQixZQUFBLFdBQUFDLEVBQUEsa0NBQUFDLFNBQUEsU0FQQVAsT0FBQUMsU0FBQUMsS0FBQSxVQ25DQWxCLFFBQUFDLE9BQUEsZUFBQXVCLFFBQUEsVUFBQSxRQUFBLE1BQUEsU0FBQUMsRUFBQUMsR0FHQSxRQUFBQyxHQUFBQyxFQUFBZCxHQUNBZSxNQUFBQyxLQUFBQyxNQUNBQSxLQUFBQyxLQUFBRCxLQUFBRSxZQUFBRCxLQUNBRCxLQUFBSCxXQUFBQSxFQUVBRyxLQUFBakIsUUFEQSxnQkFBQUEsR0FDQUEsRUFF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LGVBQUE0RixJQUVBMUUsRUFBQWxCLGVBQUFRLEtBQUFwRSxJQUtBLEtBQUEsR0FBQXlKLEdBQUEzRSxFQUFBbEIsZUFBQThGLE9BQUEsRUFBQUQsR0FBQSxJQUFBQSxFQUNBOUMsRUFBQUcsS0FBQSxTQUFBOEMsR0FBQSxNQUFBQSxHQUFBbEUsS0FBQVosRUFBQWxCLGVBQUE2RixHQUFBL0QsTUFDQVosRUFBQWxCLGVBQUFpRyxPQUFBSixFQUFBLEVBS0FuSCxHQUFBLFNBSUFqQyxFQUFBMkQsVUFBQXRCLE9BQUEsV0FDQVYsS0FBQTZCLFNBQUEsTUFDQTdCLEtBQUFjLGFBR0E3QixPQUFBQyxTQUFBQyxLQUFBLDBCQUdBZCxFQUFBMkQsVUFBQThGLHFCQUFBLFNBQUFDLEVBQUF6SCxHQUNBLEdBQUFDLElBQ0F5SCxXQUFBLHFCQUNBQyxLQUFBRixFQUNBRyxhQUFBakosT0FBQUMsU0FBQWlKLE9BQ0FDLFVBQUFwSSxLQUFBaUIsVUFDQW9ILGNBQUFySSxLQUFBa0IsY0FHQXhCLEdBQUFxRSxLQUFBLHFEQUFBL0QsS0FBQWlCLFVBQUFWLEdBQUFpRCxRQUFBLFNBQUFqRCxFQUFBQyxHQUNBLE1BQUEsT0FBQUEsR0FBQSxnQkFBQUQsR0FBQUQsRUFBQSxHQUFBVixHQUFBWSxFQUFBRCxRQUVBRCxHQUFBLEtBQUFDLEVBQUErSCxnQkFDQTFKLE1BQUF5QixFQUFBQyxLQUdBRyxFQUFBLEdBQUFwQyIsImZpbGUiOiJzZXR1cC5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuLy8gY3JlYXRlIG1haW4gYXBwbGljYXRpb24gbW9kdWxlXG52YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ0FwcGxpY2F0aW9uJywgWyduZ0FuaW1hdGUnLCAnYW5ndWxhci1tZDUnXSk7XG5cbmFwcC5jb250cm9sbGVyKCdTZXR1cENvbnRyb2xsZXInLCBbJyRzY29wZScsICdDbGllbnQnLCBmdW5jdGlvbiAoJHNjb3BlLCBDbGllbnQpIHtcbiAgICAkc2NvcGUuaW5pdGlhbGl6ZWQgPSBmYWxzZTtcbiAgICAkc2NvcGUuYnVzeSA9IGZhbHNlO1xuXG4gICAgJHNjb3BlLnVzZXJuYW1lID0gJyc7XG4gICAgJHNjb3BlLmVtYWlsID0gJyc7XG4gICAgJHNjb3BlLnBhc3N3b3JkID0gJyc7XG4gICAgJHNjb3BlLnBhc3N3b3JkUmVwZWF0ID0gJyc7XG5cbiAgICAkc2NvcGUuZXJyb3IgPSAnJztcblxuICAgICRzY29wZS5zdWJtaXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICRzY29wZS5idXN5ID0gdHJ1ZTtcbiAgICAgICAgJHNjb3BlLmVycm9yID0gJyc7XG5cbiAgICAgICAgQ2xpZW50LmNyZWF0ZUFkbWluKCRzY29wZS51c2VybmFtZSwgJHNjb3BlLnBhc3N3b3JkLCAkc2NvcGUuZW1haWwsIGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmVycm9yID0gZXJyb3IubWVzc2FnZTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdJbnRlcm5hbCBlcnJvcicsIGVycm9yKTtcblxuICAgICAgICAgICAgICAgICRzY29wZS5idXN5ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9ICcvJztcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIENsaWVudC5pc1NlcnZlckZpcnN0VGltZShmdW5jdGlvbiAoZXJyb3IsIGlzRmlyc3RUaW1lKSB7XG4gICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSAnL2Vycm9yLmh0bWwnO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFpc0ZpcnN0VGltZSkge1xuICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSAnLyc7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICAkc2NvcGUuaW5pdGlhbGl6ZWQgPSB0cnVlO1xuXG4gICAgICAgIC8vIGhhY2sgZm9yIGF1dG9mb2N1cyB3aXRoIGFuZ3VsYXJcbiAgICAgICAgc2V0VGltZW91dCggZnVuY3Rpb24gKCkgeyAkKCdpbnB1dFthdXRvZm9jdXNdOnZpc2libGU6Zmlyc3QnKS5mb2N1cygpOyB9LCAwKTtcbiAgICB9KTtcbn1dKTtcbiIsIid1c2Ugc3RyaWN0JztcblxuLyogZ2xvYmFsIGFuZ3VsYXIgKi9cbi8qIGdsb2JhbCBFdmVudFNvdXJjZSAqL1xuXG5hbmd1bGFyLm1vZHVsZSgnQXBwbGljYXRpb24nKS5zZXJ2aWNlKCdDbGllbnQnLCBbJyRodHRwJywgJ21kNScsIGZ1bmN0aW9uICgkaHR0cCwgbWQ1KSB7XG4gICAgdmFyIGNsaWVudCA9IG51bGw7XG5cbiAgICBmdW5jdGlvbiBDbGllbnRFcnJvcihzdGF0dXNDb2RlLCBtZXNzYWdlKSB7XG4gICAgICAgIEVycm9yLmNhbGwodGhpcyk7XG4gICAgICAgIHRoaXMubmFtZSA9IHRoaXMuY29uc3RydWN0b3IubmFtZTtcbiAgICAgICAgdGhpcy5zdGF0dXNDb2RlID0gc3RhdHVzQ29kZTtcbiAgICAgICAgaWYgKHR5cGVvZiBtZXNzYWdlID09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICB0aGlzLm1lc3NhZ2UgPSBtZXNzYWdlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5tZXNzYWdlID0gSlNPTi5zdHJpbmdpZnkobWVzc2FnZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBkZWZhdWx0RXJyb3JIYW5kbGVyKGNhbGxiYWNrKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoZGF0YSwgc3RhdHVzKSB7XG4gICAgICAgICAgICBpZiAoc3RhdHVzID09PSA0MDEpIHJldHVybiBjbGllbnQubG9nb3V0KCk7XG4gICAgICAgICAgICBjYWxsYmFjayhuZXcgQ2xpZW50RXJyb3Ioc3RhdHVzLCBkYXRhKSk7XG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gQ2xpZW50KCkge1xuICAgICAgICB0aGlzLl9yZWFkeSA9IGZhbHNlO1xuICAgICAgICB0aGlzLl9jb25maWdMaXN0ZW5lciA9IFtdO1xuICAgICAgICB0aGlzLl9yZWFkeUxpc3RlbmVyID0gW107XG4gICAgICAgIHRoaXMuX3VzZXJJbmZvID0ge1xuICAgICAgICAgICAgdXNlcm5hbWU6IG51bGwsXG4gICAgICAgICAgICBlbWFpbDogbnVsbCxcbiAgICAgICAgICAgIGFkbWluOiBmYWxzZVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLl90b2tlbiA9IG51bGw7XG4gICAgICAgIHRoaXMuX2NsaWVudElkID0gJ2NpZC13ZWJhZG1pbic7XG4gICAgICAgIHRoaXMuX2NsaWVudFNlY3JldCA9ICd1bnVzZWQnO1xuICAgICAgICB0aGlzLl9jb25maWcgPSB7XG4gICAgICAgICAgICBhcGlTZXJ2ZXJPcmlnaW46IG51bGwsXG4gICAgICAgICAgICB3ZWJTZXJ2ZXJPcmlnaW46IG51bGwsXG4gICAgICAgICAgICBmcWRuOiBudWxsLFxuICAgICAgICAgICAgaXA6IG51bGwsXG4gICAgICAgICAgICByZXZpc2lvbjogbnVsbCxcbiAgICAgICAgICAgIHVwZGF0ZTogbnVsbCxcbiAgICAgICAgICAgIGlzRGV2OiBmYWxzZSxcbiAgICAgICAgICAgIHByb2dyZXNzOiB7fVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLl9pbnN0YWxsZWRBcHBzID0gW107XG5cbiAgICAgICAgdGhpcy5zZXRUb2tlbihsb2NhbFN0b3JhZ2UudG9rZW4pO1xuICAgIH1cblxuICAgIENsaWVudC5wcm90b3R5cGUuc2V0UmVhZHkgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLl9yZWFkeSkgcmV0dXJuO1xuXG4gICAgICAgIHRoaXMuX3JlYWR5ID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5fcmVhZHlMaXN0ZW5lci5mb3JFYWNoKGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIENsaWVudC5wcm90b3R5cGUub25SZWFkeSA9IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgICAgICBpZiAodGhpcy5fcmVhZHkpIGNhbGxiYWNrKCk7XG4gICAgICAgIHRoaXMuX3JlYWR5TGlzdGVuZXIucHVzaChjYWxsYmFjayk7XG4gICAgfTtcblxuICAgIENsaWVudC5wcm90b3R5cGUub25Db25maWcgPSBmdW5jdGlvbiAoY2FsbGJhY2spIHtcbiAgICAgICAgdGhpcy5fY29uZmlnTGlzdGVuZXIucHVzaChjYWxsYmFjayk7XG4gICAgICAgIGNhbGxiYWNrKHRoaXMuX2NvbmZpZyk7XG4gICAgfTtcblxuICAgIENsaWVudC5wcm90b3R5cGUuc2V0VXNlckluZm8gPSBmdW5jdGlvbiAodXNlckluZm8pIHtcbiAgICAgICAgLy8gSW4gb3JkZXIgdG8ga2VlcCB0aGUgYW5ndWxhciBiaW5kaW5ncyBhbGl2ZSwgc2V0IGVhY2ggcHJvcGVydHkgaW5kaXZpZHVhbGx5XG4gICAgICAgIHRoaXMuX3VzZXJJbmZvLnVzZXJuYW1lID0gdXNlckluZm8udXNlcm5hbWU7XG4gICAgICAgIHRoaXMuX3VzZXJJbmZvLmVtYWlsID0gdXNlckluZm8uZW1haWw7XG4gICAgICAgIHRoaXMuX3VzZXJJbmZvLmFkbWluID0gISF1c2VySW5mby5hZG1pbjtcbiAgICAgICAgdGhpcy5fdXNlckluZm8uZ3JhdmF0YXIgPSAnaHR0cHM6Ly93d3cuZ3JhdmF0YXIuY29tL2F2YXRhci8nICsgbWQ1LmNyZWF0ZUhhc2godXNlckluZm8uZW1haWwudG9Mb3dlckNhc2UoKSkgKyAnLmpwZz9zPTI0JmQ9bW0nO1xuICAgIH07XG5cbiAgICBDbGllbnQucHJvdG90eXBlLnNldENvbmZpZyA9IGZ1bmN0aW9uIChjb25maWcpIHtcbiAgICAgICAgLy8gSW4gb3JkZXIgdG8ga2VlcCB0aGUgYW5ndWxhciBiaW5kaW5ncyBhbGl2ZSwgc2V0IGVhY2ggcHJvcGVydHkgaW5kaXZpZHVhbGx5IChUT0RPOiBqdXN0IHVzZSBhbmd1bGFyLmNvcHkgPylcbiAgICAgICAgdGhpcy5fY29uZmlnLmFwaVNlcnZlck9yaWdpbiA9IGNvbmZpZy5hcGlTZXJ2ZXJPcmlnaW47XG4gICAgICAgIHRoaXMuX2NvbmZpZy53ZWJTZXJ2ZXJPcmlnaW4gPSBjb25maWcud2ViU2VydmVyT3JpZ2luO1xuICAgICAgICB0aGlzLl9jb25maWcudmVyc2lvbiA9IGNvbmZpZy52ZXJzaW9uO1xuICAgICAgICB0aGlzLl9jb25maWcuZnFkbiA9IGNvbmZpZy5mcWRuO1xuICAgICAgICB0aGlzLl9jb25maWcuaXAgPSBjb25maWcuaXA7XG4gICAgICAgIHRoaXMuX2NvbmZpZy5yZXZpc2lvbiA9IGNvbmZpZy5yZXZpc2lvbjtcbiAgICAgICAgdGhpcy5fY29uZmlnLnVwZGF0ZSA9IGNvbmZpZy51cGRhdGU7XG4gICAgICAgIHRoaXMuX2NvbmZpZy5pc0RldiA9IGNvbmZpZy5pc0RldjtcbiAgICAgICAgdGhpcy5fY29uZmlnLnByb2dyZXNzID0gY29uZmlnLnByb2dyZXNzO1xuXG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcblxuICAgICAgICB0aGlzLl9jb25maWdMaXN0ZW5lci5mb3JFYWNoKGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgICAgICAgICAgY2FsbGJhY2sodGhhdC5fY29uZmlnKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIENsaWVudC5wcm90b3R5cGUuZ2V0SW5zdGFsbGVkQXBwcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2luc3RhbGxlZEFwcHM7XG4gICAgfTtcblxuICAgIENsaWVudC5wcm90b3R5cGUuZ2V0VXNlckluZm8gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl91c2VySW5mbztcbiAgICB9O1xuXG4gICAgQ2xpZW50LnByb3RvdHlwZS5nZXRDb25maWcgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9jb25maWc7XG4gICAgfTtcblxuICAgIENsaWVudC5wcm90b3R5cGUuc2V0VG9rZW4gPSBmdW5jdGlvbiAodG9rZW4pIHtcbiAgICAgICAgJGh0dHAuZGVmYXVsdHMuaGVhZGVycy5jb21tb24uQXV0aG9yaXphdGlvbiA9ICdCZWFyZXIgJyArIHRva2VuO1xuICAgICAgICBpZiAoIXRva2VuKSBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgndG9rZW4nKTtcbiAgICAgICAgZWxzZSBsb2NhbFN0b3JhZ2UudG9rZW4gPSB0b2tlbjtcbiAgICAgICAgdGhpcy5fdG9rZW4gPSB0b2tlbjtcbiAgICB9O1xuXG4gICAgLypcbiAgICAgKiBSZXN0IEFQSSB3cmFwcGVyc1xuICAgICAqL1xuICAgIENsaWVudC5wcm90b3R5cGUuY29uZmlnID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgICAgICRodHRwLmdldCgnL2FwaS92MS9jbG91ZHJvbi9jb25maWcnKS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEsIHN0YXR1cykge1xuICAgICAgICAgICAgaWYgKHN0YXR1cyAhPT0gMjAwIHx8IHR5cGVvZiBkYXRhICE9PSAnb2JqZWN0JykgcmV0dXJuIGNhbGxiYWNrKG5ldyBDbGllbnRFcnJvcihzdGF0dXMsIGRhdGEpKTtcbiAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIGRhdGEpO1xuICAgICAgICB9KS5lcnJvcihkZWZhdWx0RXJyb3JIYW5kbGVyKGNhbGxiYWNrKSk7XG4gICAgfTtcblxuICAgIENsaWVudC5wcm90b3R5cGUudXNlckluZm8gPSBmdW5jdGlvbiAoY2FsbGJhY2spIHtcbiAgICAgICAgJGh0dHAuZ2V0KCcvYXBpL3YxL3Byb2ZpbGUnKS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEsIHN0YXR1cykge1xuICAgICAgICAgICAgaWYgKHN0YXR1cyAhPT0gMjAwIHx8IHR5cGVvZiBkYXRhICE9PSAnb2JqZWN0JykgcmV0dXJuIGNhbGxiYWNrKG5ldyBDbGllbnRFcnJvcihzdGF0dXMsIGRhdGEpKTtcbiAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIGRhdGEpO1xuICAgICAgICB9KS5lcnJvcihkZWZhdWx0RXJyb3JIYW5kbGVyKGNhbGxiYWNrKSk7XG4gICAgfTtcblxuICAgIENsaWVudC5wcm90b3R5cGUuaW5zdGFsbEFwcCA9IGZ1bmN0aW9uIChpZCwgdmVyc2lvbiwgcGFzc3dvcmQsIHRpdGxlLCBjb25maWcsIGNhbGxiYWNrKSB7XG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgdmFyIGRhdGEgPSB7IGFwcFN0b3JlSWQ6IGlkLCB2ZXJzaW9uOiB2ZXJzaW9uLCBwYXNzd29yZDogcGFzc3dvcmQsIGxvY2F0aW9uOiBjb25maWcubG9jYXRpb24sIHBvcnRCaW5kaW5nczogY29uZmlnLnBvcnRCaW5kaW5ncywgYWNjZXNzUmVzdHJpY3Rpb246IGNvbmZpZy5hY2Nlc3NSZXN0cmljdGlvbiB9O1xuICAgICAgICAkaHR0cC5wb3N0KCcvYXBpL3YxL2FwcHMvaW5zdGFsbCcsIGRhdGEpLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEsIHN0YXR1cykge1xuICAgICAgICAgICAgaWYgKHN0YXR1cyAhPT0gMjAyIHx8IHR5cGVvZiBkYXRhICE9PSAnb2JqZWN0JykgcmV0dXJuIGNhbGxiYWNrKG5ldyBDbGllbnRFcnJvcihzdGF0dXMsIGRhdGEpKTtcblxuICAgICAgICAgICAgLy8gcHV0IG5ldyBhcHAgd2l0aCBhbWVuZGVkIHRpdGxlIGluIGNhY2hlXG4gICAgICAgICAgICBkYXRhLm1hbmlmZXN0ID0geyB0aXRsZTogdGl0bGUgfTtcbiAgICAgICAgICAgIHRoYXQuX2luc3RhbGxlZEFwcHMucHVzaChkYXRhKTtcblxuICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgZGF0YS5pZCk7XG4gICAgICAgIH0pLmVycm9yKGRlZmF1bHRFcnJvckhhbmRsZXIoY2FsbGJhY2spKTtcbiAgICB9O1xuXG4gICAgQ2xpZW50LnByb3RvdHlwZS5jb25maWd1cmVBcHAgPSBmdW5jdGlvbiAoaWQsIHBhc3N3b3JkLCBjb25maWcsIGNhbGxiYWNrKSB7XG4gICAgICAgIHZhciBkYXRhID0geyBhcHBJZDogaWQsIHBhc3N3b3JkOiBwYXNzd29yZCwgbG9jYXRpb246IGNvbmZpZy5sb2NhdGlvbiwgcG9ydEJpbmRpbmdzOiBjb25maWcucG9ydEJpbmRpbmdzLCBhY2Nlc3NSZXN0cmljdGlvbjogY29uZmlnLmFjY2Vzc1Jlc3RyaWN0aW9uIH07XG4gICAgICAgICRodHRwLnBvc3QoJy9hcGkvdjEvYXBwcy8nICsgaWQgKyAnL2NvbmZpZ3VyZScsIGRhdGEpLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEsIHN0YXR1cykge1xuICAgICAgICAgICAgaWYgKHN0YXR1cyAhPT0gMjAyKSByZXR1cm4gY2FsbGJhY2sobmV3IENsaWVudEVycm9yKHN0YXR1cywgZGF0YSkpO1xuICAgICAgICAgICAgY2FsbGJhY2sobnVsbCk7XG4gICAgICAgIH0pLmVycm9yKGRlZmF1bHRFcnJvckhhbmRsZXIoY2FsbGJhY2spKTtcbiAgICB9O1xuXG4gICAgQ2xpZW50LnByb3RvdHlwZS51cGRhdGVBcHAgPSBmdW5jdGlvbiAoaWQsIHZlcnNpb24sIGNhbGxiYWNrKSB7XG4gICAgICAgICRodHRwLnBvc3QoJy9hcGkvdjEvYXBwcy8nICsgaWQgKyAnL3VwZGF0ZScsIHsgdmVyc2lvbjogdmVyc2lvbiB9KS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhLCBzdGF0dXMpIHtcbiAgICAgICAgICAgIGlmIChzdGF0dXMgIT09IDIwMikgcmV0dXJuIGNhbGxiYWNrKG5ldyBDbGllbnRFcnJvcihzdGF0dXMsIGRhdGEpKTtcbiAgICAgICAgICAgIGNhbGxiYWNrKG51bGwpO1xuICAgICAgICB9KS5lcnJvcihkZWZhdWx0RXJyb3JIYW5kbGVyKGNhbGxiYWNrKSk7XG4gICAgfTtcblxuICAgIENsaWVudC5wcm90b3R5cGUuc3RhcnRBcHAgPSBmdW5jdGlvbiAoaWQsIGNhbGxiYWNrKSB7XG4gICAgICAgIHZhciBkYXRhID0geyB9O1xuICAgICAgICAkaHR0cC5wb3N0KCcvYXBpL3YxL2FwcHMvJyArIGlkICsgJy9zdGFydCcsIGRhdGEpLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEsIHN0YXR1cykge1xuICAgICAgICAgICAgaWYgKHN0YXR1cyAhPT0gMjAyKSByZXR1cm4gY2FsbGJhY2sobmV3IENsaWVudEVycm9yKHN0YXR1cywgZGF0YSkpO1xuICAgICAgICAgICAgY2FsbGJhY2sobnVsbCk7XG4gICAgICAgIH0pLmVycm9yKGRlZmF1bHRFcnJvckhhbmRsZXIoY2FsbGJhY2spKTtcbiAgICB9O1xuXG4gICAgQ2xpZW50LnByb3RvdHlwZS5zdG9wQXBwID0gZnVuY3Rpb24gKGlkLCBjYWxsYmFjaykge1xuICAgICAgICB2YXIgZGF0YSA9IHsgfTtcbiAgICAgICAgJGh0dHAucG9zdCgnL2FwaS92MS9hcHBzLycgKyBpZCArICcvc3RvcCcsIGRhdGEpLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEsIHN0YXR1cykge1xuICAgICAgICAgICAgaWYgKHN0YXR1cyAhPT0gMjAyKSByZXR1cm4gY2FsbGJhY2sobmV3IENsaWVudEVycm9yKHN0YXR1cywgZGF0YSkpO1xuICAgICAgICAgICAgY2FsbGJhY2sobnVsbCk7XG4gICAgICAgIH0pLmVycm9yKGRlZmF1bHRFcnJvckhhbmRsZXIoY2FsbGJhY2spKTtcbiAgICB9O1xuXG4gICAgQ2xpZW50LnByb3RvdHlwZS52ZXJzaW9uID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgICAgICRodHRwLmdldCgnL2FwaS92MS9jbG91ZHJvbi9zdGF0dXMnKS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEsIHN0YXR1cykge1xuICAgICAgICAgICAgaWYgKHN0YXR1cyAhPT0gMjAwIHx8IHR5cGVvZiBkYXRhICE9PSAnb2JqZWN0JykgcmV0dXJuIGNhbGxiYWNrKG5ldyBDbGllbnRFcnJvcihzdGF0dXMsIGRhdGEpKTtcbiAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIGRhdGEpO1xuICAgICAgICB9KS5lcnJvcihkZWZhdWx0RXJyb3JIYW5kbGVyKGNhbGxiYWNrKSk7XG4gICAgfTtcblxuICAgIENsaWVudC5wcm90b3R5cGUuaXNTZXJ2ZXJGaXJzdFRpbWUgPSBmdW5jdGlvbiAoY2FsbGJhY2spIHtcbiAgICAgICAgJGh0dHAuZ2V0KCcvYXBpL3YxL2Nsb3Vkcm9uL3N0YXR1cycpLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSwgc3RhdHVzKSB7XG4gICAgICAgICAgICBpZiAoc3RhdHVzICE9PSAyMDAgfHwgdHlwZW9mIGRhdGEgIT09ICdvYmplY3QnKSByZXR1cm4gY2FsbGJhY2sobmV3IENsaWVudEVycm9yKHN0YXR1cywgZGF0YSkpO1xuICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgIWRhdGEuYWN0aXZhdGVkKTtcbiAgICAgICAgfSkuZXJyb3IoZGVmYXVsdEVycm9ySGFuZGxlcihjYWxsYmFjaykpO1xuICAgIH07XG5cbiAgICBDbGllbnQucHJvdG90eXBlLmdldE5ha2VkRG9tYWluID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgICAgICRodHRwLmdldCgnL2FwaS92MS9zZXR0aW5ncy9uYWtlZF9kb21haW4nKVxuICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSwgc3RhdHVzKSB7XG4gICAgICAgICAgICBpZiAoc3RhdHVzICE9PSAyMDAgfHwgdHlwZW9mIGRhdGEgIT09ICdvYmplY3QnKSByZXR1cm4gY2FsbGJhY2sobmV3IENsaWVudEVycm9yKHN0YXR1cywgZGF0YSkpO1xuICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgZGF0YS5hcHBpZCk7XG4gICAgICAgIH0pLmVycm9yKGRlZmF1bHRFcnJvckhhbmRsZXIoY2FsbGJhY2spKTtcbiAgICB9O1xuXG4gICAgQ2xpZW50LnByb3RvdHlwZS5zZXROYWtlZERvbWFpbiA9IGZ1bmN0aW9uIChhcHBpZCwgY2FsbGJhY2spIHtcbiAgICAgICAgJGh0dHAucG9zdCgnL2FwaS92MS9zZXR0aW5ncy9uYWtlZF9kb21haW4nLCB7IGFwcGlkOiBhcHBpZCB9KS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhLCBzdGF0dXMpIHtcbiAgICAgICAgICAgIGlmIChzdGF0dXMgIT09IDIwNCkgcmV0dXJuIGNhbGxiYWNrKG5ldyBDbGllbnRFcnJvcihzdGF0dXMpKTtcbiAgICAgICAgICAgIGNhbGxiYWNrKG51bGwpO1xuICAgICAgICB9KS5lcnJvcihkZWZhdWx0RXJyb3JIYW5kbGVyKGNhbGxiYWNrKSk7XG4gICAgfTtcblxuICAgIENsaWVudC5wcm90b3R5cGUuZ2V0QXBwcyA9IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgICAgICAkaHR0cC5nZXQoJy9hcGkvdjEvYXBwcycpLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEsIHN0YXR1cykge1xuICAgICAgICAgICAgaWYgKHN0YXR1cyAhPT0gMjAwIHx8IHR5cGVvZiBkYXRhICE9PSAnb2JqZWN0JykgcmV0dXJuIGNhbGxiYWNrKG5ldyBDbGllbnRFcnJvcihzdGF0dXMsIGRhdGEpKTtcbiAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIGRhdGEuYXBwcyk7XG4gICAgICAgIH0pLmVycm9yKGRlZmF1bHRFcnJvckhhbmRsZXIoY2FsbGJhY2spKTtcbiAgICB9O1xuXG4gICAgQ2xpZW50LnByb3RvdHlwZS5nZXRBcHAgPSBmdW5jdGlvbiAoYXBwSWQsIGNhbGxiYWNrKSB7XG4gICAgICAgIHZhciBhcHBGb3VuZCA9IG51bGw7XG4gICAgICAgIHRoaXMuX2luc3RhbGxlZEFwcHMuc29tZShmdW5jdGlvbiAoYXBwKSB7XG4gICAgICAgICAgICBpZiAoYXBwLmlkID09PSBhcHBJZCkge1xuICAgICAgICAgICAgICAgIGFwcEZvdW5kID0gYXBwO1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmIChhcHBGb3VuZCkgcmV0dXJuIGNhbGxiYWNrKG51bGwsIGFwcEZvdW5kKTtcbiAgICAgICAgZWxzZSByZXR1cm4gY2FsbGJhY2sobmV3IEVycm9yKCdBcHAgbm90IGZvdW5kJykpO1xuICAgIH07XG5cbiAgICBDbGllbnQucHJvdG90eXBlLnVuaW5zdGFsbEFwcCA9IGZ1bmN0aW9uIChhcHBJZCwgY2FsbGJhY2spIHtcbiAgICAgICAgJGh0dHAucG9zdCgnL2FwaS92MS9hcHBzLycgKyBhcHBJZCArICcvdW5pbnN0YWxsJykuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSwgc3RhdHVzKSB7XG4gICAgICAgICAgICBpZiAoc3RhdHVzICE9PSAyMDIpIHJldHVybiBjYWxsYmFjayhuZXcgQ2xpZW50RXJyb3Ioc3RhdHVzLCBkYXRhKSk7XG4gICAgICAgICAgICBjYWxsYmFjayhudWxsKTtcbiAgICAgICAgfSkuZXJyb3IoZGVmYXVsdEVycm9ySGFuZGxlcihjYWxsYmFjaykpO1xuICAgIH07XG5cbiAgICBDbGllbnQucHJvdG90eXBlLmdldEFwcExvZ1N0cmVhbSA9IGZ1bmN0aW9uIChhcHBJZCkge1xuICAgICAgICB2YXIgc291cmNlID0gbmV3IEV2ZW50U291cmNlKCcvYXBpL3YxL2FwcHMvJyArIGFwcElkICsgJy9sb2dzdHJlYW0nKTtcbiAgICAgICAgcmV0dXJuIHNvdXJjZTtcbiAgICB9O1xuXG4gICAgQ2xpZW50LnByb3RvdHlwZS5nZXRBcHBMb2dVcmwgPSBmdW5jdGlvbiAoYXBwSWQpIHtcbiAgICAgICAgcmV0dXJuICcvYXBpL3YxL2FwcHMvJyArIGFwcElkICsgJy9sb2dzP2FjY2Vzc190b2tlbj0nICsgdGhpcy5fdG9rZW47XG4gICAgfTtcblxuICAgIENsaWVudC5wcm90b3R5cGUuc2V0QWRtaW4gPSBmdW5jdGlvbiAodXNlcm5hbWUsIGFkbWluLCBjYWxsYmFjaykge1xuICAgICAgICB2YXIgcGF5bG9hZCA9IHtcbiAgICAgICAgICAgIHVzZXJuYW1lOiB1c2VybmFtZSxcbiAgICAgICAgICAgIGFkbWluOiBhZG1pblxuICAgICAgICB9O1xuXG4gICAgICAgICRodHRwLnBvc3QoJy9hcGkvdjEvdXNlcnMvJyArIHVzZXJuYW1lICsgJy9hZG1pbicsIHBheWxvYWQpLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEsIHN0YXR1cykge1xuICAgICAgICAgICAgaWYgKHN0YXR1cyAhPT0gMjA0KSByZXR1cm4gY2FsbGJhY2sobmV3IENsaWVudEVycm9yKHN0YXR1cywgZGF0YSkpO1xuICAgICAgICAgICAgY2FsbGJhY2sobnVsbCk7XG4gICAgICAgIH0pLmVycm9yKGRlZmF1bHRFcnJvckhhbmRsZXIoY2FsbGJhY2spKTtcbiAgICB9O1xuXG4gICAgQ2xpZW50LnByb3RvdHlwZS5jcmVhdGVBZG1pbiA9IGZ1bmN0aW9uICh1c2VybmFtZSwgcGFzc3dvcmQsIGVtYWlsLCBjYWxsYmFjaykge1xuICAgICAgICB2YXIgcGF5bG9hZCA9IHtcbiAgICAgICAgICAgIHVzZXJuYW1lOiB1c2VybmFtZSxcbiAgICAgICAgICAgIHBhc3N3b3JkOiBwYXNzd29yZCxcbiAgICAgICAgICAgIGVtYWlsOiBlbWFpbFxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcblxuICAgICAgICAkaHR0cC5wb3N0KCcvYXBpL3YxL2Nsb3Vkcm9uL2FjdGl2YXRlJywgcGF5bG9hZCkuc3VjY2VzcyhmdW5jdGlvbihkYXRhLCBzdGF0dXMpIHtcbiAgICAgICAgICAgIGlmIChzdGF0dXMgIT09IDIwMSB8fCB0eXBlb2YgZGF0YSAhPT0gJ29iamVjdCcpIHJldHVybiBjYWxsYmFjayhuZXcgQ2xpZW50RXJyb3Ioc3RhdHVzLCBkYXRhKSk7XG5cbiAgICAgICAgICAgIHRoYXQuc2V0VG9rZW4oZGF0YS50b2tlbik7XG4gICAgICAgICAgICB0aGF0LnNldFVzZXJJbmZvKHsgdXNlcm5hbWU6IHVzZXJuYW1lLCBlbWFpbDogZW1haWwsIGFkbWluOiB0cnVlIH0pO1xuXG4gICAgICAgICAgICBjYWxsYmFjayhudWxsLCBkYXRhLmFjdGl2YXRlZCk7XG4gICAgICAgIH0pLmVycm9yKGRlZmF1bHRFcnJvckhhbmRsZXIoY2FsbGJhY2spKTtcbiAgICB9O1xuXG4gICAgQ2xpZW50LnByb3RvdHlwZS5saXN0VXNlcnMgPSBmdW5jdGlvbiAoY2FsbGJhY2spIHtcbiAgICAgICAgJGh0dHAuZ2V0KCcvYXBpL3YxL3VzZXJzJykuc3VjY2VzcyhmdW5jdGlvbihkYXRhLCBzdGF0dXMpIHtcbiAgICAgICAgICAgIGlmIChzdGF0dXMgIT09IDIwMCB8fCB0eXBlb2YgZGF0YSAhPT0gJ29iamVjdCcpIHJldHVybiBjYWxsYmFjayhuZXcgQ2xpZW50RXJyb3Ioc3RhdHVzLCBkYXRhKSk7XG4gICAgICAgICAgICBjYWxsYmFjayhudWxsLCBkYXRhKTtcbiAgICAgICAgfSkuZXJyb3IoZGVmYXVsdEVycm9ySGFuZGxlcihjYWxsYmFjaykpO1xuICAgIH07XG5cbiAgICBDbGllbnQucHJvdG90eXBlLnN0YXRzID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgICAgICRodHRwLmdldCgnL2FwaS92MS9jbG91ZHJvbi9zdGF0cycpLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSwgc3RhdHVzKSB7XG4gICAgICAgICAgICBpZiAoc3RhdHVzICE9PSAyMDAgfHwgdHlwZW9mIGRhdGEgIT09ICdvYmplY3QnKSByZXR1cm4gY2FsbGJhY2sobmV3IENsaWVudEVycm9yKHN0YXR1cywgZGF0YSkpO1xuICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgZGF0YSk7XG4gICAgICAgIH0pLmVycm9yKGRlZmF1bHRFcnJvckhhbmRsZXIoY2FsbGJhY2spKTtcbiAgICB9O1xuXG4gICAgQ2xpZW50LnByb3RvdHlwZS5nZXRPQXV0aENsaWVudHMgPSBmdW5jdGlvbiAoY2FsbGJhY2spIHtcbiAgICAgICAgJGh0dHAuZ2V0KCcvYXBpL3YxL29hdXRoL2NsaWVudHMnKS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEsIHN0YXR1cykge1xuICAgICAgICAgICAgaWYgKHN0YXR1cyAhPT0gMjAwIHx8IHR5cGVvZiBkYXRhICE9PSAnb2JqZWN0JykgcmV0dXJuIGNhbGxiYWNrKG5ldyBDbGllbnRFcnJvcihzdGF0dXMsIGRhdGEpKTtcbiAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIGRhdGEuY2xpZW50cyk7XG4gICAgICAgIH0pLmVycm9yKGRlZmF1bHRFcnJvckhhbmRsZXIoY2FsbGJhY2spKTtcbiAgICB9O1xuXG4gICAgQ2xpZW50LnByb3RvdHlwZS5kZWxUb2tlbnNCeUNsaWVudElkID0gZnVuY3Rpb24gKGlkLCBjYWxsYmFjaykge1xuICAgICAgICAkaHR0cC5kZWxldGUoJy9hcGkvdjEvb2F1dGgvY2xpZW50cy8nICsgaWQgKyAnL3Rva2VucycpLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSwgc3RhdHVzKSB7XG4gICAgICAgICAgICBpZiAoc3RhdHVzICE9PSAyMDQpIHJldHVybiBjYWxsYmFjayhuZXcgQ2xpZW50RXJyb3Ioc3RhdHVzLCBkYXRhKSk7XG4gICAgICAgICAgICBjYWxsYmFjayhudWxsKTtcbiAgICAgICAgfSkuZXJyb3IoZGVmYXVsdEVycm9ySGFuZGxlcihjYWxsYmFjaykpO1xuICAgIH07XG5cbiAgICBDbGllbnQucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgICAgICAkaHR0cC5nZXQoJy9hcGkvdjEvY2xvdWRyb24vdXBkYXRlJykuc3VjY2VzcyhmdW5jdGlvbihkYXRhLCBzdGF0dXMpIHtcbiAgICAgICAgICAgIGlmIChzdGF0dXMgIT09IDIwMiB8fCB0eXBlb2YgZGF0YSAhPT0gJ29iamVjdCcpIHJldHVybiBjYWxsYmFjayhuZXcgQ2xpZW50RXJyb3Ioc3RhdHVzLCBkYXRhKSk7XG4gICAgICAgICAgICBjYWxsYmFjayhudWxsLCBkYXRhKTtcbiAgICAgICAgfSkuZXJyb3IoZGVmYXVsdEVycm9ySGFuZGxlcihjYWxsYmFjaykpO1xuICAgIH07XG5cbiAgICBDbGllbnQucHJvdG90eXBlLnJlYm9vdCA9IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgICAgICAkaHR0cC5nZXQoJy9hcGkvdjEvY2xvdWRyb24vcmVib290Jykuc3VjY2VzcyhmdW5jdGlvbihkYXRhLCBzdGF0dXMpIHtcbiAgICAgICAgICAgIGlmIChzdGF0dXMgIT09IDIwMiB8fCB0eXBlb2YgZGF0YSAhPT0gJ29iamVjdCcpIHJldHVybiBjYWxsYmFjayhuZXcgQ2xpZW50RXJyb3Ioc3RhdHVzLCBkYXRhKSk7XG4gICAgICAgICAgICBjYWxsYmFjayhudWxsLCBkYXRhKTtcbiAgICAgICAgfSkuZXJyb3IoZGVmYXVsdEVycm9ySGFuZGxlcihjYWxsYmFjaykpO1xuICAgIH07XG5cbiAgICBDbGllbnQucHJvdG90eXBlLmJhY2t1cCA9IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgICAgICAkaHR0cC5wb3N0KCcvYXBpL3YxL2Nsb3Vkcm9uL2JhY2t1cHMnKS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEsIHN0YXR1cykge1xuICAgICAgICAgICAgaWYgKHN0YXR1cyAhPT0gMjAyIHx8IHR5cGVvZiBkYXRhICE9PSAnb2JqZWN0JykgcmV0dXJuIGNhbGxiYWNrKG5ldyBDbGllbnRFcnJvcihzdGF0dXMsIGRhdGEpKTtcbiAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIGRhdGEpO1xuICAgICAgICB9KS5lcnJvcihkZWZhdWx0RXJyb3JIYW5kbGVyKGNhbGxiYWNrKSk7XG4gICAgfTtcblxuICAgIENsaWVudC5wcm90b3R5cGUuc2V0Q2VydGlmaWNhdGUgPSBmdW5jdGlvbiAoY2VydGlmaWNhdGVGaWxlLCBrZXlGaWxlLCBjYWxsYmFjaykge1xuICAgICAgICBjb25zb2xlLmxvZygnd2lsbCBzZXQgY2VydGlmaWNhdGUnKTtcblxuICAgICAgICB2YXIgZmQgPSBuZXcgRm9ybURhdGEoKTtcbiAgICAgICAgZmQuYXBwZW5kKCdjZXJ0aWZpY2F0ZScsIGNlcnRpZmljYXRlRmlsZSk7XG4gICAgICAgIGZkLmFwcGVuZCgna2V5Jywga2V5RmlsZSk7XG5cbiAgICAgICAgJGh0dHAucG9zdCgnL2FwaS92MS9jbG91ZHJvbi9jZXJ0aWZpY2F0ZScsIGZkLCB7XG4gICAgICAgICAgICBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiB1bmRlZmluZWQgfSxcbiAgICAgICAgICAgIHRyYW5zZm9ybVJlcXVlc3Q6IGFuZ3VsYXIuaWRlbnRpdHlcbiAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbihkYXRhLCBzdGF0dXMpIHtcbiAgICAgICAgICAgIGlmIChzdGF0dXMgIT09IDIwMikgcmV0dXJuIGNhbGxiYWNrKG5ldyBDbGllbnRFcnJvcihzdGF0dXMsIGRhdGEpKTtcbiAgICAgICAgICAgIGNhbGxiYWNrKG51bGwpO1xuICAgICAgICB9KS5lcnJvcihkZWZhdWx0RXJyb3JIYW5kbGVyKGNhbGxiYWNrKSk7XG4gICAgfTtcblxuICAgIENsaWVudC5wcm90b3R5cGUuZ3JhcGhzID0gZnVuY3Rpb24gKHRhcmdldHMsIGZyb20sIGNhbGxiYWNrKSB7XG4gICAgICAgIHZhciBjb25maWcgPSB7XG4gICAgICAgICAgICBwYXJhbXM6IHtcbiAgICAgICAgICAgICAgICB0YXJnZXQ6IHRhcmdldHMsXG4gICAgICAgICAgICAgICAgZm9ybWF0OiAnanNvbicsXG4gICAgICAgICAgICAgICAgZnJvbTogZnJvbVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgICRodHRwLmdldCgnL2FwaS92MS9jbG91ZHJvbi9ncmFwaHMnLCBjb25maWcpLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEsIHN0YXR1cykge1xuICAgICAgICAgICAgaWYgKHN0YXR1cyAhPT0gMjAwIHx8IHR5cGVvZiBkYXRhICE9PSAnb2JqZWN0JykgcmV0dXJuIGNhbGxiYWNrKG5ldyBDbGllbnRFcnJvcihzdGF0dXMsIGRhdGEpKTtcbiAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIGRhdGEpO1xuICAgICAgICB9KS5lcnJvcihkZWZhdWx0RXJyb3JIYW5kbGVyKGNhbGxiYWNrKSk7XG4gICAgfTtcblxuICAgIENsaWVudC5wcm90b3R5cGUuY3JlYXRlVXNlciA9IGZ1bmN0aW9uICh1c2VybmFtZSwgZW1haWwsIGNhbGxiYWNrKSB7XG4gICAgICAgIHZhciBkYXRhID0ge1xuICAgICAgICAgICAgdXNlcm5hbWU6IHVzZXJuYW1lLFxuICAgICAgICAgICAgZW1haWw6IGVtYWlsXG4gICAgICAgIH07XG5cbiAgICAgICAgJGh0dHAucG9zdCgnL2FwaS92MS91c2VycycsIGRhdGEpLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSwgc3RhdHVzKSB7XG4gICAgICAgICAgICBpZiAoc3RhdHVzICE9PSAyMDEgfHwgdHlwZW9mIGRhdGEgIT09ICdvYmplY3QnKSByZXR1cm4gY2FsbGJhY2sobmV3IENsaWVudEVycm9yKHN0YXR1cywgZGF0YSkpO1xuICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgZGF0YSk7XG4gICAgICAgIH0pLmVycm9yKGRlZmF1bHRFcnJvckhhbmRsZXIoY2FsbGJhY2spKTtcbiAgICB9O1xuXG4gICAgQ2xpZW50LnByb3RvdHlwZS5yZW1vdmVVc2VyID0gZnVuY3Rpb24gKHVzZXJuYW1lLCBwYXNzd29yZCwgY2FsbGJhY2spIHtcbiAgICAgICAgdmFyIGRhdGEgPSB7XG4gICAgICAgICAgICB1c2VybmFtZTogdXNlcm5hbWUsXG4gICAgICAgICAgICBwYXNzd29yZDogcGFzc3dvcmRcbiAgICAgICAgfTtcblxuICAgICAgICAkaHR0cCh7IG1ldGhvZDogJ0RFTEVURScsIHVybDogJy9hcGkvdjEvdXNlcnMvJyArIHVzZXJuYW1lLCBkYXRhOiBkYXRhLCBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicgfX0pLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSwgc3RhdHVzKSB7XG4gICAgICAgICAgICBpZiAoc3RhdHVzICE9PSAyMDQpIHJldHVybiBjYWxsYmFjayhuZXcgQ2xpZW50RXJyb3Ioc3RhdHVzLCBkYXRhKSk7XG4gICAgICAgICAgICBjYWxsYmFjayhudWxsKTtcbiAgICAgICAgfSkuZXJyb3IoZGVmYXVsdEVycm9ySGFuZGxlcihjYWxsYmFjaykpO1xuICAgIH07XG5cbiAgICBDbGllbnQucHJvdG90eXBlLmNoYW5nZVBhc3N3b3JkID0gZnVuY3Rpb24gKGN1cnJlbnRQYXNzd29yZCwgbmV3UGFzc3dvcmQsIGNhbGxiYWNrKSB7XG4gICAgICAgIHZhciBkYXRhID0ge1xuICAgICAgICAgICAgcGFzc3dvcmQ6IGN1cnJlbnRQYXNzd29yZCxcbiAgICAgICAgICAgIG5ld1Bhc3N3b3JkOiBuZXdQYXNzd29yZFxuICAgICAgICB9O1xuXG4gICAgICAgICRodHRwLnBvc3QoJy9hcGkvdjEvdXNlcnMvJyArIHRoaXMuX3VzZXJJbmZvLnVzZXJuYW1lICsgJy9wYXNzd29yZCcsIGRhdGEpLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSwgc3RhdHVzKSB7XG4gICAgICAgICAgICBpZiAoc3RhdHVzICE9PSAyMDQgfHwgdHlwZW9mIGRhdGEgIT09ICdvYmplY3QnKSByZXR1cm4gY2FsbGJhY2sobmV3IENsaWVudEVycm9yKHN0YXR1cywgZGF0YSkpO1xuICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgZGF0YSk7XG4gICAgICAgIH0pLmVycm9yKGRlZmF1bHRFcnJvckhhbmRsZXIoY2FsbGJhY2spKTtcbiAgICB9O1xuXG4gICAgQ2xpZW50LnByb3RvdHlwZS5yZWZyZXNoQ29uZmlnID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcblxuICAgICAgICBjYWxsYmFjayA9IHR5cGVvZiBjYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJyA/IGNhbGxiYWNrIDogZnVuY3Rpb24gKCkge307XG5cbiAgICAgICAgdGhpcy5jb25maWcoZnVuY3Rpb24gKGVycm9yLCByZXN1bHQpIHtcbiAgICAgICAgICAgIGlmIChlcnJvcikgcmV0dXJuIGNhbGxiYWNrKGVycm9yKTtcblxuICAgICAgICAgICAgdGhhdC5zZXRDb25maWcocmVzdWx0KTtcbiAgICAgICAgICAgIGNhbGxiYWNrKG51bGwpO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgQ2xpZW50LnByb3RvdHlwZS5yZWZyZXNoSW5zdGFsbGVkQXBwcyA9IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG5cbiAgICAgICAgY2FsbGJhY2sgPSB0eXBlb2YgY2FsbGJhY2sgPT09ICdmdW5jdGlvbicgPyBjYWxsYmFjayA6IGZ1bmN0aW9uICgpIHt9O1xuXG4gICAgICAgIHRoaXMuZ2V0QXBwcyhmdW5jdGlvbiAoZXJyb3IsIGFwcHMpIHtcbiAgICAgICAgICAgIGlmIChlcnJvcikgcmV0dXJuIGNhbGxiYWNrKGVycm9yKTtcblxuICAgICAgICAgICAgLy8gaW5zZXJ0IG9yIHVwZGF0ZSBuZXcgYXBwc1xuICAgICAgICAgICAgYXBwcy5mb3JFYWNoKGZ1bmN0aW9uIChhcHApIHtcbiAgICAgICAgICAgICAgICB2YXIgZm91bmQgPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhhdC5faW5zdGFsbGVkQXBwcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhhdC5faW5zdGFsbGVkQXBwc1tpXS5pZCA9PT0gYXBwLmlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3VuZCA9IGk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChmb3VuZCAhPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5jb3B5KGFwcCwgdGhhdC5faW5zdGFsbGVkQXBwc1tmb3VuZF0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuX2luc3RhbGxlZEFwcHMucHVzaChhcHApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBmaWx0ZXIgb3V0IG9sZCBlbnRyaWVzLCBnb2luZyBiYWNrd2FyZHMgdG8gYWxsb3cgc3BsaWNpbmdcbiAgICAgICAgICAgIGZvcih2YXIgaSA9IHRoYXQuX2luc3RhbGxlZEFwcHMubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHtcbiAgICAgICAgICAgICAgICBpZiAoIWFwcHMuc29tZShmdW5jdGlvbiAoZWxlbSkgeyByZXR1cm4gKGVsZW0uaWQgPT09IHRoYXQuX2luc3RhbGxlZEFwcHNbaV0uaWQpOyB9KSkge1xuICAgICAgICAgICAgICAgICAgICB0aGF0Ll9pbnN0YWxsZWRBcHBzLnNwbGljZShpLCAxKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY2FsbGJhY2sobnVsbCk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBDbGllbnQucHJvdG90eXBlLmxvZ291dCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5zZXRUb2tlbihudWxsKTtcbiAgICAgICAgdGhpcy5fdXNlckluZm8gPSB7fTtcblxuICAgICAgICAvLyBsb2dvdXQgZnJvbSBPQXV0aCBzZXNzaW9uXG4gICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJy9hcGkvdjEvc2Vzc2lvbi9sb2dvdXQnO1xuICAgIH07XG5cbiAgICBDbGllbnQucHJvdG90eXBlLmV4Y2hhbmdlQ29kZUZvclRva2VuID0gZnVuY3Rpb24gKGF1dGhDb2RlLCBjYWxsYmFjaykge1xuICAgICAgICB2YXIgZGF0YSA9IHtcbiAgICAgICAgICAgIGdyYW50X3R5cGU6ICdhdXRob3JpemF0aW9uX2NvZGUnLFxuICAgICAgICAgICAgY29kZTogYXV0aENvZGUsXG4gICAgICAgICAgICByZWRpcmVjdF91cmk6IHdpbmRvdy5sb2NhdGlvbi5vcmlnaW4sXG4gICAgICAgICAgICBjbGllbnRfaWQ6IHRoaXMuX2NsaWVudElkLFxuICAgICAgICAgICAgY2xpZW50X3NlY3JldDogdGhpcy5fY2xpZW50U2VjcmV0XG4gICAgICAgIH07XG5cbiAgICAgICAgJGh0dHAucG9zdCgnL2FwaS92MS9vYXV0aC90b2tlbj9yZXNwb25zZV90eXBlPXRva2VuJmNsaWVudF9pZD0nICsgdGhpcy5fY2xpZW50SWQsIGRhdGEpLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSwgc3RhdHVzKSB7XG4gICAgICAgICAgICBpZiAoc3RhdHVzICE9PSAyMDAgfHwgdHlwZW9mIGRhdGEgIT09ICdvYmplY3QnKSByZXR1cm4gY2FsbGJhY2sobmV3IENsaWVudEVycm9yKHN0YXR1cywgZGF0YSkpO1xuXG4gICAgICAgICAgICBjYWxsYmFjayhudWxsLCBkYXRhLmFjY2Vzc190b2tlbik7XG4gICAgICAgIH0pLmVycm9yKGRlZmF1bHRFcnJvckhhbmRsZXIoY2FsbGJhY2spKTtcbiAgICB9O1xuXG4gICAgY2xpZW50ID0gbmV3IENsaWVudCgpO1xuICAgIHJldHVybiBjbGllbnQ7XG59XSk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=